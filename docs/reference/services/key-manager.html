<!DOCTYPE html>
<html>
	<head>
		<title>$if(pagetitle)$$pagetitle$$endif$</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<link rel="stylesheet" href="_css/chrome.css" />
		<link rel="stylesheet" href="../_css/chrome.css" />
		<link rel="stylesheet" href="../../_css/chrome.css" />
		<link rel="stylesheet" href="../../../_css/chrome.css" />
		<script src="_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="../../../_js/jquery-1.4.2.min.js" type="text/javascript"></script>
		<script src="_js/doc.js" type="text/javascript"></script>
		<script src="../_js/doc.js" type="text/javascript"></script>
		<script src="../../_js/doc.js" type="text/javascript"></script>
		<script src="../../../_js/doc.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="content">
    
    <h1 id="key-manager">
      Key Manager
    </h1>
    <p>
      The Key Manager (KM) provides JavaScript applications with key management and cryptographic functionality. It makes this available on the device's public bus via a number of API calls. The Key Manager implements a key <em>store</em>, allowing apps a place to safely keep keys where they are readily available for cryptographic operations.
    </p><img src="/images/km.jpg">
    <p>
      The Key Manager is designed to do the following:
    </p>
    <ul>
      <li>
        <p>
          Provide apps and services easy access to cryptographic functions they need to perform local tasks safely, comply with standards, and interact with external services.
        </p>
      </li>
      <li>
        <p>
          Protect user secrets (keys, passwords, etc.) in the event of loss or theft. Even if the device is in Developer Mode, possession alone should not provide access to secrets.
        </p>
      </li>
      <li>
        <p>
          Protect application secrets (keys, tokens, etc.) from disclosure to the user or other applications.
        </p>
      </li>
      <li>
        <p>
          Provide apps and services access, via a flexible and easy-to-use interface, to commonly used encryption algorithms such as AES, DES/3DES, and HMAC, and digest functions such as SHA-1.
        </p>
      </li>
    </ul>
    <p>
      Keys are stored encrypted in a database. They have both an app name (i.e., <code>&quot;com.someone.appname&quot;</code>) and a key name. The latter is not necessarily unique -- two different apps can both have a key with the same name. However, the Key Manager service obtains the app name from the protocol, making it almost impossible for apps to use the same keys.
    </p>
    <p>
      An app can use the KM service to store or generate a key while specifying its encryption algorithm type, length, and an option to <em>hide</em> the key and never return it to the application, though it remains available for cryptographic operations.
    </p>
    <p>
      <strong>In this section:</strong>
    </p>
    <ul>
      <li>
        <a href="#supported-key-types">Supported Key Types</a>
      </li>
      <li>
        <a href="#supported-block-cipher-modes">Supported Block Cipher Modes</a>
      </li>
      <li>
        <a href="#supported-block-cipher-padding-modes">Supported Block Cipher Padding Modes</a>
      </li>
      <li>
        <a href="#methods">Methods</a>
      </li>
    </ul>
    <hr>
    <h2 id="supported-key-types">
      Supported Key Types
    </h2>
    <p>
      In cryptography, a key is a piece of information (a parameter) that determines the functional output of a cryptographic algorithm or cipher. Without a key, the algorithm would have no result. In encryption, a key specifies the particular transformation of plaintext (unencrypted text) into ciphertext (encrypted text), or vice-versa during decryption. Keys are also used in other cryptographic algorithms, such as digital signature schemes and message authentication codes.
    </p>
    <p>
      Key Manager supports the following key encryption algorithm types:
    </p>
    <ul>
      <li>
        <p>
          <strong>AES</strong> -- Advanced Encryption Standard. AES-128, AES-192, and AES-256 are supported.
        </p>
      </li>
      <li>
        <p>
          <strong>3DES</strong> (3 key outer CBC) -- The size includes the padding.
        </p>
      </li>
      <li>
        <p>
          <strong>DES</strong> is supported but discouraged since it is a weak algorithm.
        </p>
      </li>
    </ul>
    <p>
      <strong>Note</strong>: Imported DES and 3DES keys must have valid DES parity.
    </p>
    <ul>
      <li>
        <p>
          <strong>HMAC -- SHA1</strong> -- Hash-based Message Authentication Code - Secure Hash Algorithm-1 . Any size from 16 bytes up is supported.
        </p>
      </li>
      <li>
        <p>
          <strong>BLOB</strong> -- For storing any type of data, up to 4k bytes.
        </p>
      </li>
      <li>
        <p>
          <strong>ASCIIBLOB</strong> -- An ascii (non-base64 encoded) BLOB. The data must be in valid JSON format with no unescaped JSON formatting characters. This can also be used for storing up to 4k of data.
        </p>
      </li>
    </ul>
    <hr>
    <h2 id="supported-block-cipher-modes">
      Supported Block Cipher Modes
    </h2>
    <p>
      A block cipher is a type of symmetric-key encryption algorithm that transforms a fixed-length block of plaintext data into a block of ciphertext data of the same length. This transformation takes place with the aid of a user-provided secret key. Decryption is performed by applying the reverse transformation to the ciphertext block using the same secret key. The fixed length is called the block size, and for many block ciphers, the block size is 64 bits or 128 bits.
    </p>
    <p>
      AES and DES/3DES are the supported block ciphers. The block size for DES/3DES is 8 and for AES it's 16.
    </p>
    <p>
      Key Manager supports the following block cipher modes:
    </p>
    <ul>
      <li>
        <strong>CBC</strong> -- Cipher Block Chaining.
      </li>
      <li>
        <strong>ECB</strong> -- Electronic CodeBook.
      </li>
      <li>
        <strong>CFB</strong> -- Cipher FeedBack Mode. CFB is used for turning a block cipher into a stream cipher. Note that the drawback of stream ciphers is that reusing the key allows an attacker to recover the key stream and decrypt anything encrypted using it.
      </li>
    </ul>
    <hr>
    <h2 id="supported-block-cipher-padding-modes">
      Supported Block Cipher Padding Modes
    </h2>
    <p>
      Because a block cipher works on units of a fixed size, but messages come in a variety of lengths, some modes (mainly CBC) require that the final block be padded before encryption. CBC and ECB require it unless the data is a multiple of the block size. CFB does not.
    </p>
    <p>
      Key Manager supports the following block cipher padding modes:
    </p>
    <ul>
      <li>
        <strong>None</strong> -- Data must be a multiple of the block size.
      </li>
      <li>
        <strong>PKCS1</strong> -- Public Key Cryptography Standards #1.
      </li>
    </ul>
    <hr>
    <h2 id="data-formatting">
      Data Formatting
    </h2>
    <p>
      Since JSON objects are composed and formatted with ascii (UTF-8) text, data to and from the Key Manager service needs to be base64 encoded to avoid having it interpreted as JSON formatting instructions. This includes key data, data to be encrypted or decrypted, and IVs (Initialization Vectors). Developers need to do their own bas64 encoding and decoding; code for this is freely available on the Internet.
    </p>
    <hr>
    <h2 id="methods">
      Methods
    </h2>
    <ul>
      <li>
        <a href="#crypt">crypt</a> -- Encrypts or decrypts data.
      </li>
      <li>
        <a href="#export">export</a> -- Wraps a key using a specified wrapping key.
      </li>
      <li>
        <a href="#fetchKey">fetchKey</a> -- Returns key metadata and key data.
      </li>
      <li>
        <a href="#generate">generate</a> -- Generates a key.
      </li>
      <li>
        <a href="#import">import</a> -- Takes a wrapped key and imports it.
      </li>
      <li>
        <a href="#keyInfo">keyInfo</a> -- Returns key metadata but not the key data.
      </li>
      <li>
        <a href="#remove">remove</a> -- Deletes a key from the database.
      </li>
      <li>
        <a href="#store">store</a> -- Stores a key in the database.
      </li>
    </ul><a name="crypt" id="crypt"></a>
    <hr>
    <h3 id="crypt">
      crypt
    </h3>
    <p>
      You can use this API to encrypt or decrypt data. The key encryption algorithm specified (AES, DES/3DES, or HMACSHA1) <strong><em>must</em></strong> be the same as the one used to create the key.
    </p>
    <p>
      Key data needs to be base64 encoded. Since JSON objects are composed and formatted with ascii (UTF-8) text, data needs to be base64 encoded to avoid having it interpreted as JSON formatting instructions. Code for this is freely available on the Internet.
    </p>
    <h4 id="syntax">
      Syntax
    </h4>
    <pre>
{
    "keyname"   : string,
    "algorithm" : string,
    "pad"       : string,
    "mode"      : string,
    "iv"        : string,
    "decrypt"   : boolean,
    "data"      : string
}
</pre>
    <h4 id="parameters">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
        <tr>
          <td>
            algorithm
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Possible values: <code>&quot;AES&quot;, &quot;DES&quot;, &quot;3DES&quot;, or &quot;HMACSHA1&quot;</code>.
          </td>
        </tr>
        <tr>
          <td>
            pad
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Possible values: <code>&quot;PKCS1&quot;</code>, or <code>&quot;none&quot;</code>. Required for block ciphers.
          </td>
        </tr>
        <tr>
          <td>
            mode
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Possible values: <code>&quot;CBC&quot;, &quot;CFB&quot;, &quot;ECB&quot;, or &quot;none&quot;</code>. This is only appropriate for block ciphers. <code>none</code> is not valid for block ciphers.
          </td>
        </tr>
        <tr>
          <td>
            iv
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Initialization Vector -- a block of bits that is required to allow a stream cipher or a block cipher to to produce a unique stream independent from other streams produced by the same encryption key without having to go through a re-keying process. Only required for CBC and CFB modes. 16 bytes for AES, 8 bytes for DES/3DES. Should be base64-encoded.
          </td>
        </tr>
        <tr>
          <td>
            decrypt
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>false</code> to encrypt, <code>true</code> to decrypt.
          </td>
        </tr>
        <tr>
          <td>
            data
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Data to encrypt or decrypt. Should be base64-encoded.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string, |
    "data"        : string
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure)
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
        <tr>
          <td>
            data
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Encrypted data.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples">
      Examples
    </h4>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [{
         flex : 1,
         kind : "Scroller",
         components : [
         {
            name : "cryptData",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "crypt",
            onSuccess : "cryptDataSuccess",
            onFailure : "cryptDataFailure",
            subscribe : true
         },               
         {kind : "Button", name : "cryptDataButton", caption : "Encrypt Data", onclick : "cryptDataClick"}
        ]
      }]
    }],
    cryptDataClick: function() {    
         // Note that "data" has been base64 encoded    
         this.$.cryptData.call({ "keyname":"myKey", "algorithm":"AES", "decrypt":false, 
                                 "data":"SSB3YW50IHRoaXMgZGF0YSB0byBiZSBlbmNyeXB0ZWQ="});
    },
    cryptDataSuccess: function(inSender, inResponse) {
        this.log("Encrypt data success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    cryptDataFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }                           
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "crypt",
    parameters: {
            "keyname"   : "myKey",
            "algorithm" : "AES",
            "decrypt"   : false,
            "data"      : B64data
    },
    onSuccess: function(e){ Mojo.Log.info("Crypt success, data="+e.data); },
    onFailure: function(e){ Mojo.Log.info("Crypt failure, err="+e.errorText); }
});
</pre>
    <p>
      <strong>Success</strong>
    </p>
    <pre>
 Encrypt data success, results=
 {
   "data":"cfOqsq443VfOtMBUdpCZY6aTq0LmiV7SodWlvVOEQNr8rFhhkLmMXm8nv1cvzteI",
   "returnValue":true
}
</pre><a name="export" id="export"></a>
    <hr>
    <h3 id="export">
      export
    </h3>
    <p>
      Wraps a key using a specified wrapping key. Both keys must belong to the same owner. A key can not wrap itself.
    </p>
    <h4 id="syntax-1">
      Syntax
    </h4>
    <pre>
{ 
    "keyname"         : string,
    "wrappingkeyname" : string
}
</pre>
    <h4 id="parameters-1">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
        <tr>
          <td>
            wrappingkeyname
          </td>
          <td>
            string
          </td>
          <td>
            Wrapping key name.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-1">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string, |
    "wrappedkey"  : string
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure)
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
        <tr>
          <td>
            wrappedkey
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Wrapped key returned on success.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-1">
      Examples
    </h4>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
 
 this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "export",
    parameters: {
        "keyname": "MyKey",
        "wrappingkeyname": "MyWrappingKey"
    },
    onSuccess: function(e) {Mojo.Log.info("KeyManager: export success="+JSON.stringify(e));},
    onFailure: function(e) {Mojo.Log.info("KeyManager: export failure="+JSON.stringify(e));}
});
</pre><a name="fetchKey" id="fetchKey"></a>
    <hr>
    <h3 id="fetchkey">
      fetchKey
    </h3>
    <p>
      Returns key metadata and key data. Key data is returned if the key had been originally stored or generated with nohide = <code>true</code>. Otherwise, the call fails and a &quot;key is not exportable&quot; error message is returned.
    </p>
    <h4 id="syntax-2">
      Syntax
    </h4>
    <pre>
{
    "keyname" : string
}
</pre>
    <h4 id="parameters-2">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-2">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string, |
    "keyname"     : string,
    "type"        : string,
    "keydata"     : string,
    "nohide"      : boolean,    
    "noexport"    : boolean,
    "backup"      : boolean,
    "cloud"       : boolean,
    "shared"      : boolean,
    "unwrap_only" : boolean
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
        <tr>
          <td>
            keyname
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Key name. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            type
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Key type. One of the following -- <code>&quot;AES&quot;, &quot;DES&quot;, &quot;3DES&quot;, &quot;HMACSHA1&quot;, &quot;BLOB&quot;, or &quot;ASCIIBLOB&quot;</code>. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            keydata
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Optional key data string. Returned if <code>nohide</code> is <code>true</code>. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            nohide
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>true</code>, it means key data can be returned with this call. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            backup
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Is this key backed up in the cloud with the device backup? Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            noexport
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Key can be exported flag. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            cloud
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Is this key stored in the cloud and used for backups? Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            unwrap_only
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>true</code>, key can only be used to unwrap wrapped keys and no other operation. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            shared
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Can other apps access the key flag. Returned on success.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-2">
      Examples
    </h4>
    <p>
      <strong>luna-send</strong>
    </p>
    <pre>
 luna-send -n 1   luna://com.palm.keymanager/fetchKey '{"keyname":"myKey"}'
{"backup":false,"cloud":false,"keydata":"VUV7/1cYn9WRRyxArRXBrg==","keyname":"myKey","noexport":false,"nohide":true,"returnValue":true,"shared":true,"type":"AES","unwrap_only":false}
</pre>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [
         {
            name : "fetchKey",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "fetchKey",
            onSuccess : "fetchKeySuccess",
            onFailure : "fetchKeyFailure",
            subscribe : true
         },
         {kind : "Button", name : "fetchKeyButton", caption : "Fetch Key", onclick : "fetchKeyClick"}        
        ]
      }]
    }],
    fetchKeyClick: function() {     
         this.$.fetchKey.call({"keyname":"myKey"});
    },
    fetchKeySuccess: function(inSender, inResponse) {
        this.log("Generate key success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    fetchKeyFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }   
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "fetchKey",
    parameters: {
        "keyname" :"MyKey"
    },
    onSuccess: function(e){ var MyKeyB64 = Base64.decode(e.keydata); },
    onFailure: function(e){ Mojo.Log.info("fetchKey Failure, err="+e.errorText); }
});
</pre>
    <p>
      <strong>Success</strong>
    </p>
    <pre>
Generate key success, results=
{
   "backup":false,
   "cloud":false,
   "keydata":"VUV7/1cYn9WRRyxArRXBrg==",
   "keyname":"myKey",
   "noexport":false,
   "nohide":true,
   "returnValue":true,
   "shared":true,
   "type":"AES",
   "unwrap_only":false
}
</pre><a name="generate" id="generate"></a>
    <hr>
    <h3 id="generate">
      generate
    </h3>
    <p>
      Generates a key with the name specified. If <code>nohide = true</code>, the key data can be accessed with <code>fetchKey</code>.
    </p>
    <p>
      Supported types and their size requirements:
    </p>
    <ul>
      <li>AES -- 16 (default), 24 or 32 bytes. These sizes correspond to AES 128, 192 or 256 bit.
      </li>
      <li>DES/3DES -- 24 bytes.
      </li>
      <li>HMACSHA1 -- 16 bytes or up.
      </li>
    </ul>
    <h4 id="syntax-3">
      Syntax
    </h4>
    <pre>
{
     "keyname": string,
     "size"   : integer,
     "type"   : string,
     "nohide" : boolean
}
</pre>
    <h4 id="parameters-3">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Name of key to generate.
          </td>
        </tr>
        <tr>
          <td>
            size
          </td>
          <td>
            Yes
          </td>
          <td>
            integer
          </td>
          <td>
            Key size in bytes.
          </td>
        </tr>
        <tr>
          <td>
            type
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key type. Must be one of the following -- &quot;AES&quot;, &quot;DES&quot;, &quot;3DES&quot;, or &quot;HMACSHA1&quot;.
          </td>
        </tr>
        <tr>
          <td>
            nohide
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>false</code> (default), the key data can not be exported with <code>fetchKey</code>.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-3">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string
}
</pre>
    <table>
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-3">
      Examples
    </h4>
    <p>
      <strong>luna-send</strong>
    </p>
    <pre>
 luna-send -n 1 luna://com.palm.keymanager/generate '{"keyname":"myKey", "type":"AES", "nohide": true, "size": 16}'
{"returnValue":true}
</pre>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [{
         flex : 1,
         kind : "Scroller",
         components : [{
            name : "genKey",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "generate",
            onSuccess : "genKeySuccess",
            onFailure : "genKeyFailure",
            subscribe : true
         },
         {kind : "Button", name : "genKeyButton", caption : "Generate Key", onclick : "genKeyClick"}
        ]
      }]
    }],
    genKeyClick: function() {       
         this.$.genKey.call({"keyname":"myKey", "type":"AES", "nohide": true, "size": 16});
    },
    genKeySuccess: function(inSender, inResponse) {
        this.log("Generate key success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    genKeyFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "generate",
    parameters: {
        "keyname" : "MyGenKey",
        "size"    : 16,
        "type"    : "HMACSHA1",
        "nohide"  : true
    },
    onSuccess: function(e){ Mojo.Log.info("KeyManager: Generate MyGenKey success, e="+JSON.stringify(e)); },
    onFailure: function(e){ Mojo.Log.info("KeyManager: Generate MyGenKey failure, e="+JSON.stringify(e)); }
});
</pre><a name="import" id="import"></a>
    <hr>
    <h3 id="import">
      import
    </h3>
    <p>
      Import takes a wrapped key and imports it. If the wrapping key is not present, the key is not installed and an error is returned. If successful, the unwrapped key's name is returned. A wrapped key can not replace an existing key with the same owner and name.
    </p>
    <h4 id="syntax-4">
      Syntax
    </h4>
    <pre>
{
    "wrappedkey": string
}
</pre>
    <h4 id="parameters-4">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            wrappedkey
          </td>
          <td>
            string
          </td>
          <td>
            Wrapped key.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-4">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string, |
    "keyname"     : string
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            keyname
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-4">
      Examples
    </h4>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "import",
    parameters: {
        "wrappedkey": "MyWrappedKey"
    },
    onSuccess: function(e){ Mojo.Log.info("Import success, e="+JSON.stringify(e)); },
    onFailure: function(e){ Mojo.Log.info("Import failure, e="+JSON.stringify(e)); }
});
</pre><a name="keyInfo" id="keyInfo"></a>
    <hr>
    <h3 id="keyinfo">
      keyInfo
    </h3>
    <p>
      Returns the key's metadata but not the key data.
    </p>
    <h4 id="syntax-5">
      Syntax
    </h4>
    <pre>
{
    "keyname" : string
}
</pre>
    <h4 id="parameters-5">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr>
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key name
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-5">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string, |
    "keyname"     : string,
    "type"        : string,
    "nohide"      : boolean,
    "backup"      : boolean,
    "noexport"    : boolean,
    "cloud"       : boolean,
    "unwrap_only" : boolean,
    "shared"      : boolean
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
        <tr>
          <td>
            keyname
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Key name. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            type
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            One of the following -- <code>&quot;AES&quot;, &quot;DES&quot;, &quot;3DES&quot;, &quot;HMACSHA1&quot;, &quot;BLOB&quot;, or &quot;ASCIIBLOB&quot;</code>. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            nohide
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Indicates if key data is accessible via fetchKey (<code>true</code>), or can only be used for operations (<code>false</code>). Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            backup
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Is this key backed up in the cloud with the device backup? Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            noexport
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Key can be exported flag. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            cloud
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Is this key stored in the cloud and used for backups? Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            unwrap_only
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>true</code>, key can only be used to unwrap wrapped keys and no other operation. Returned on success.
          </td>
        </tr>
        <tr>
          <td>
            shared
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Can other apps access the key flag. Returned on success.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-5">
      Examples
    </h4>
    <p>
      <strong>luna-send</strong>
    </p>
    <pre>
luna-send -n 1 luna://com.palm.keymanager/keyInfo '{"keyname":"myKey"}'
{"backup":false,"cloud":false,"keyname":"unknown","noexport":false,"nohide":true,"returnValue":true,"shared":true,"type":"AES","unwrap_only":false}
</pre>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [{
         flex : 1,
         kind : "Scroller",
         components : [ 
         {
            name : "getKeyInfo",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "keyInfo",
            onSuccess : "getKeyinfoSuccess",
            onFailure : "getKeyinfoFailure",
            subscribe : true
         }, 
         {kind : "Button", name : "getKeyinfoButton", caption : "Get Key Info", onclick : "getKeyinfoClick"}
        ]
      }]
    }],
    getKeyinfoClick: function() {       
         this.$.getKeyInfo.call({"keyname":"myKey"});
    },
    getKeyinfoSuccess: function(inSender, inResponse) {
        this.log("Get key info success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    getKeyinfoFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }           
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "keyInfo",
    parameters: {
        "keyname" :"MyKey"
    },
    onSuccess: function(e){ Mojo.Log.info("keyInfo Success: type= "+e.type); },
    onFailure: function(e){ Mojo.Log.info("keyInfo Failure err="+JSON.stringify(e)); }
});
</pre>
    <p>
      <strong>Success</strong>
    </p>
    <pre>
Get key info success, results=
{
   "backup":false,
   "cloud":false,
   "keyname":"com.palmdts.enyo.keymanager",
   "noexport":false,
   "nohide":true,
   "returnValue":true,
   "shared":true,
   "type":"AES",
   "unwrap_only":false
}
</pre><a name="remove" id="remove"></a>
    <hr>
    <h3 id="remove">
      remove
    </h3>
    <p>
      Given a key name, removes a key from the key store.
    </p>
    <h4 id="syntax-6">
      Syntax
    </h4>
    <pre>
{
    "keyname" : string
}
</pre>
    <h4 id="parameters-6">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-6">
      Returns
    </h4>
    <pre>
{
    "returnValue" : boolean,
    "errorText"   : string
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message on failure.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-6">
      Examples
    </h4>
    <p>
      <strong>luna-send</strong>
    </p>
    <pre>
 luna-send -n 1 -a com.palmdts.enyo.keymanager luna://com.palm.keymanager/remove '{"keyname":"myStoredKey"}'
{"returnValue":true}
</pre>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [{
         flex : 1,
         kind : "Scroller",
         components : [             
         {
            name : "removeKey",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "remove",
            onSuccess : "removeKeySuccess",
            onFailure : "removeKeyFailure",
            subscribe : true
         },            
         {kind : "Button", name : "removeKeyButton", caption : "Remove Key", onclick : "removeKeyClick"}
        ]
      }]
    }],
    removeKeyClick: function() {        
         this.$.removeKey.call({ "keyname":"myStoredKey"});
    },
    removeKeySuccess: function(inSender, inResponse) {
        this.log("Remove key success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    removeKeyFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }                               
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "remove",
    parameters: {
        "keyname" : "MyKey4"
    },
    onSuccess: function(e){ Mojo.Log.info("Remove key success"); },
    onFailure: function(e){ Mojo.Log.info("Remove key failure, err="+JSON.stringify(e)); }
});
</pre><a name="store" id="store"></a>
    <hr>
    <h3 id="store">
      store
    </h3>
    <p>
      Stores a key in the database given a key name, data, key encryption algorithm type, and other optional parameters.
    </p>
    <p>
      Key data needs to be base64 encoded unless its <code>type</code> is <code>ASCIIBLOB</code>. Since JSON objects are composed and formatted with ascii (UTF-8) text, data needs to be base64 encoded to avoid having it interpreted as JSON formatting instructions. Code for this is freely available on the Internet.
    </p>
    <p>
      <code>Type</code> must be one of the supported key types -- <code>AES, DES/3DES, HMACSHA1, BLOB, or ASCIIBLOB.</code> <code>BLOB</code> is not actually a key type, but can be used to safely store data (up to 4096 bytes) of any kind. <code>ASCIIBLOB</code> is the same as <code>BLOB</code>, but for storing ascii, JSON formatted text.
    </p>
    <p>
      If <code>nohide</code> is set to <code>false</code> (default), the key data can not be exported with <a href="#fetchKey">fetchKey</a>. <code>BLOB</code> types should not have <code>nohide</code> set, as that makes them useless.
    </p>
    <p>
      The <code>backup</code> flag (keys backed up in the cloud with the device backup) is <code>false</code> by default.
    </p>
    <p>
      The <code>cloud</code> flag indicates a key which is stored in the cloud and is a special key for backups. If <code>true</code>, The type should be <code>ASCIIBLOB</code> and the keydata contains the backup-specific part of the URL for fetching the key.
    </p>
    <h4 id="syntax-7">
      Syntax
    </h4>
    <pre>
{
    "keyname" : string,
    "keydata" : string,
    "type"    : string,
    "nohide"  : boolean,
    "backup"  : boolean,
    "cloud"   : boolean
}
</pre>
    <h4 id="parameters-7">
      Parameters
    </h4>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            keyname
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key name.
          </td>
        </tr>
        <tr>
          <td>
            keydata
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key data. Key data needs to be base64 encoded unless its <code>type</code> is <code>ASCIIBLOB</code>.
          </td>
        </tr>
        <tr>
          <td>
            type
          </td>
          <td>
            Yes
          </td>
          <td>
            string
          </td>
          <td>
            Key algroithm encryption type. Must be one of the following -- AES, DES, 3DES, HMACSHA1, BLOB, or ASCIIBLOB. DES/3DES keys must be properly formed with DES parity bits and weak key checking already done.
          </td>
        </tr>
        <tr>
          <td>
            nohide
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>false</code> (default), the key data can not be exported with <code>fetchKey</code>.
          </td>
        </tr>
        <tr>
          <td>
            backup
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            If <code>true</code>, this key is backed up in the cloud with the device backup. This field is <code>false</code> by default.
          </td>
        </tr>
        <tr>
          <td>
            cloud
          </td>
          <td>
            No
          </td>
          <td>
            boolean
          </td>
          <td>
            Indicates a key which is stored in the cloud and is a special key for backups. The type should be <code>ASCIIBLOB</code> and the <code>keydata</code> contains the backup-specific part of the URL for fetching the key.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="returns-7">
      Returns
    </h4>
    <pre>
{ 
    "returnValue" : boolean,
    "errorText"   : string
}
</pre>
    <table border="1">
      <thead>
        <tr bgcolor="lightgrey">
          <th>
            Argument
          </th>
          <th>
            Required
          </th>
          <th>
            Type
          </th>
          <th>
            Description
          </th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td>
            returnValue
          </td>
          <td>
            Yes
          </td>
          <td>
            boolean
          </td>
          <td>
            <code>true</code> (success) or <code>false</code> (failure).
          </td>
        </tr>
        <tr>
          <td>
            errorText
          </td>
          <td>
            No
          </td>
          <td>
            string
          </td>
          <td>
            Error message returned on failure.
          </td>
        </tr>
      </tbody>
    </table>
    <h4 id="examples-7">
      Examples
    </h4>
    <p>
      <strong>Enyo</strong>
    </p>
    <pre>
enyo.kind({
   name : "enyo.Canon.KeyManager",
   kind : enyo.VFlexBox,
   components : [ 
     { flex : 1,
      kind : "Pane",
      components : [{
         flex : 1,
         kind : "Scroller",
         components : [ {
            name : "storeKey",
            kind : "PalmService",
            service : "palm://com.palm.keymanager",
            method : "store",
            onSuccess : "storeKeySuccess",
            onFailure : "storeKeyFailure",
            subscribe : true
         }, 
         {kind : "Button", name : "storeKeyButton", caption : "Store Key", onclick : "storeKeyClick"}
        ]
      }]
    }],
    storeKeyClick: function() { 
         // Note that keydata has been base64 encoded    
         this.$.storeKey.call({"keyname":"myStoredKey", "keydata":"dmdyZmY0NWU4OTBnZGVzMg==", "type":"AES", 
                               "nohide": "true", "backup":true, "cloud":true});
    },
    storeKeySuccess: function(inSender, inResponse) {
        this.log("Store key success, results=" + enyo.json.stringify(inResponse));
    },          
    // Log errors to the console for debugging
    storeKeyFailure: function(inSender, inError, inRequest) {
        this.log(enyo.json.stringify(inError));
    }                   
});
</pre>
    <p>
      <strong>Mojo</strong>
    </p>
    <pre>
//  Note that Base64 encoding functionality is something YOU need to provide. 
// "KeyDataB64" is 16 bytes.

KeyDataB64 = Base64.encode(KeyData);
this.controller.serviceRequest("palm://com.palm.keymanager/", {
    method: "store",
    parameters: {
        "keyname" : "MyKey",
        "keydata" : KeyDataB64,
        "type"    : "AES",
        "nohide"  : true
    },
    onSuccess: function(e){ Mojo.Log.info("Store key success"); },
    onFailure: function(e){ Mojo.Log.info("Store key failure, err="+JSON.stringify(e)); }
});
</pre>
		</div>
	</body>
</html>