  <!DOCTYPE html>
  <html>
  	<head>
  		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  		<title>Enyo API Reference</title>
  		<link rel="shortcut icon" href="/favicon.ico"/>
  		<meta http-equiv="Content-Type" content="text/html; charset=utf8"/>
  		<meta name="apple-mobile-web-app-capable" content="yes"/>
  		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
  
  		<link rel="stylesheet" type="text/css" href="../../css/prism.css" />
  		
  		<link rel="stylesheet" type="text/css" href="../../css/style.css" />
  
  		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  		<!--[if lt IE 9]>
  		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
  		<![endif]-->
  
  
  	</head>
  	<body>
  		<div class="container-fluid">
  			<div class="row" id="header">
  				<div class="col-xs-12">
  					<div class="row">
  						<!-- PLACEHOLDER FOR LOGO -->
  						<div class="col-sm-6 title">
  							<span>ENYODOCS</span>
  						</div>
  						<div class="col-sm-6 primary-nav">
  								<a href="http://enyojs.com">ENYOJS.COM</a>
  								<a href="../../index.html#/home">DOCS HOME</a>
  						</div>
  					</div>
  					<div class="row">
  
  						<nav role="navigation" class="navbar navbar-default fixed-nav">
  							<!-- Brand and toggle get grouped for better mobile display -->
  							<div class="navbar-header">
  								<button id="navbarButton" type="button" data-target="#navbarCollapse" data-toggle="collapse" class="navbar-toggle">
  									<span class="sr-only">Toggle navigation</span>
  									<span class="icon-bar"></span>
  									<span class="icon-bar"></span>
  									<span class="icon-bar"></span>
  								</button>
  								<!--<a href="#" class="navbar-brand">Enyo Docs</a>-->
  							</div>
  							<!-- Collection of nav links and other content for toggling -->
  							<div id="navbarCollapse" class="collapse navbar-collapse">
  								<ul class="nav navbar-nav">
  									<li><a href="../../index.html#/namespaces">Namespaces</a></li>
  									<li><a href="../../index.html#/kinds">Kinds</a></li>
  									<li><a href="../../index.html#/glossary">Glossary</a></li>
  									<li><a href="../../index.html#/utilities">Utilities</a></li>
  									<li><a href="../index.html">Developer Guide</a></li>
  									<li><a href="http://enyojs.com/sampler">Enyo Sampler</a></li>
  									<li class="top hidden-xs hidden-sm"><a id="top-link" href="javascript:void(0);">top</a></li>
  									<li class="show-hide-private"><a id="show-hide-link" href="javascript:void(0);">show private</a></li>
  								</ul>
  							</div>
  						</nav>
  
  					</div>
  				</div>
  			</div>
  
  		</div>

<div id="index" class="hide-private">

  <div id="content" class="guide container">

<h1 class="title">Tutorial: Building a Moonstone App</h1>
<h2 id="introduction">Introduction</h2>
<p>In this tutorial, we will build a basic TV application using the Moonstone UI library. Our application will perform Flickr searches, and will follow Moonstone’s “always viewing” Panels pattern.</p>
<p>We’ll walk through the creation of “Search” and “Detail” panel views, crafting subkinds of <a href="../..//#/kind/enyo.Source">enyo.Source</a>, <a href="../..//#/kind/enyo.Collection">enyo.Collection</a> and <a href="../..//#/kind/enyo.Model">enyo.Model</a> to meet the demands of the Flickr API, and binding the returned data to our views–all typical things you will need to do in an interactive, data-driven application.</p>
<p>If you’d like to get an idea of where we’re heading, you can <a href="http://enyojs.github.io/moon-flickr">view the completed app</a> or <a href="https://github.com/enyojs/moon-flickr">browse the completed source code</a>.</p>
<h2 id="set-up-your-development-environment">1. Set up your development environment</h2>
<p>There are four main tools that make up the bread-and-butter of Enyo development:</p>
<ul>
<li>Your favorite <strong>code editor</strong></li>
<li>A <strong>Git client</strong>, for checking out an Enyo bootplate template</li>
<li><strong>Node.js</strong>, a server-side JavaScript runtime, for minifying your finished application</li>
<li>A <strong>Web browser</strong> and <strong>Web server</strong>. Although not strictly required, the server will let you avoid browser security restrictions in Chrome, among other benefits.</li>
</ul>
<p><a href="first-steps.html">First Steps with Enyo</a> provides detailed instructions for obtaining and installing these tools, along with some suggested choices (where appropriate). If you are already familiar with the tools, feel free to install them on your own and move on to step 2.</p>
<h2 id="get-a-bootplate-project-template">2. Get a “bootplate” project template</h2>
<p>We’ll start by cloning the <code>bootplate-moonstone</code> project template from GitHub.</p>
<p>While this step is also covered in <a href="first-steps.html">First Steps with Enyo</a>, there’s no harm in repeating the essential Git command:</p>
<pre><code>    git clone --recursive --branch 2.5.1 https://github.com/enyojs/bootplate-moonstone.git &lt;myapp&gt;</code></pre>
<h2 id="customize-app-boilerplate">3. Customize app boilerplate</h2>
<p>After cloning, we’ll make some customizations to the template to accommodate our new app.</p>
<ul>
<li><p>In <code>debug.html</code> and <code>index.html</code>, let’s set the <code>&lt;title&gt;</code> tag to <code>"Moonstone Flickr"</code>.</p></li>
<li><p>In <code>source/views/views.js</code>, let’s establish a namespace (<code>"flickr"</code>) for our custom kinds by renaming <code>myapp.MainView</code> to <code>flickr.MainView</code>.</p></li>
<li><p>Likewise, in <code>source/app.js</code>, we’ll change the names <code>myapp.Application</code> and <code>myapp.MainView</code> to <code>flickr.Application</code> and <code>flickr.MainView</code>, respectively.</p></li>
</ul>
<p><strong>For your information:</strong> The files we just modified comprise the set of files involved in the startup of your bootplate app. When <code>debug.html</code> (or, after deployment, <code>index.html</code>) is opened, it first loads the Enyo core CSS and JavaScript files, along with the application’s top-level <code>package.js</code>. The top-level <code>package.js</code> loads any Enyo libraries your app depends on, and then the application’s <code>app.js</code> file. <code>app.js</code> defines your top-level <a href="../..//#/kind/enyo.Application">enyo.Application</a>, registers an <code>enyo.ready</code> callback (fired when the DOM is ready), and creates an instance of the application. Finally, by default, <code>enyo.Application</code> automatically renders the “main view” upon instantiation–i.e., it creates and renders the <code>MainView</code> kind from <code>main.js</code>, thus starting your app.</p>
<h2 id="set-up-main-view">4. Set up main view</h2>
<p>Since this app will be based on the Moonstone “Always Viewing” Panel pattern, let’s set up our main view to have a <a href="../..//#/kind/moon.Panels">moon.Panels</a> instance (which will be responsible for maintaining a stack of panels and transitioning them left and right) and a single instance of <a href="../..//#/kind/moon.Panel">moon.Panel</a>, the base kind for views added to <code>moon.Panels</code>.</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb2"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb2-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb2-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.MainView&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-3" title="3">        <span class="dt">classes</span><span class="op">:</span> <span class="st">&quot;moon enyo-fit&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb2-4" title="4">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb2-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panels&quot;</span><span class="op">,</span> <span class="dt">classes</span><span class="op">:</span> <span class="st">&quot;enyo-fit&quot;</span><span class="op">,</span> <span class="dt">pattern</span><span class="op">:</span> <span class="st">&quot;alwaysviewing&quot;</span><span class="op">,</span> <span class="dt">popOnBack</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb2-6" title="6">                <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span> <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;First Panel&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb2-7" title="7">            ]<span class="op">}</span></a>
<a class="sourceLine" id="cb2-8" title="8">        ]</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Here we’ve created a simple kind named <code>flickr.MainView</code>, which is a subkind of <a href="../..//#/kind/enyo.Control">enyo.Control</a> (the default kind when no <code>kind</code> property is specified). As per our plan, the main view contains an instance of <code>moon.Panels</code>, which in turn contains an instance of <code>moon.Panel</code>.</p>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>classes</strong></p>
<ul>
<li><p>The <code>moon</code> class applies standard Moonstone styling to the application. This is required at the top-level view of Moonstone apps.</p></li>
<li><p>The <code>enyo-fit</code> class fits the view to the bounds of its parent (in this case, <code>document.body</code>) via absolute positioning.</p></li>
</ul></li>
<li><p><strong><code>moon.Panels</code> properties</strong></p>
<ul>
<li><p>Applying <code>enyo-fit</code> to the <code>moon.Panels</code> kind again fits it to its parent (<code>flickr.MainView</code>), resulting in the panels’ being set to full-screen.</p></li>
<li><p>Setting <code>pattern</code> to <code>"alwaysviewing"</code> configures <code>moon.Panels</code> to arrange panels according to the “Always Viewing” panel pattern. In short, the active panel(s) will be positioned over the right 50% of the screen with semi-transparency, so that the underlying fullscreen content of the app (e.g. video player, audio player, photos, etc.) is partially visible.</p></li>
<li><p>By default, <code>moon.Panels</code> will not automatically remove panels as the user navigates back up the breadcrumb history. Setting <code>popOnBack: true</code> automatically pops panels off the stack (destroying them) once they are moved back offscreen.</p></li>
</ul></li>
</ul>
<p><strong>Expert tip:</strong> Strictly speaking, <code>enyo-fit</code> will position the control within the bounds of the control’s “offset parent”, which is an HTML term referring to the first parent element up the DOM hierarchy from the element that is either <code>position: absolute</code> or <code>position: relative</code>. This will skip over parents that are <code>position: static</code> (the default for new elements), which may be confusing at first. To force a parent to be a control’s “offset parent”, simply set <code>position: relative</code> on the intended parent’s CSS.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/84DRr/">View the code and results of Step 4 in JSFiddle</a></strong></p>
<h2 id="create-a-panel-for-searching">5. Create a panel for searching</h2>
<p>In the previous step, we added a dummy <code>moon.Panel</code> instance as a child of the <code>moon.Panels</code>. Now, let’s create a <code>moon.Panel</code> subkind to implement the view in which the user searches for photos and browses the results.</p>
<p><strong>Add to file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb3"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb3-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb3-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-4" title="4">        <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Search Flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-5" title="5">        <span class="dt">titleBelow</span><span class="op">:</span> <span class="st">&quot;Enter search term above&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb3-6" title="6">        <span class="dt">headerOptions</span><span class="op">:</span> <span class="op">{</span><span class="dt">inputMode</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">dismissOnEnter</span><span class="op">:</span> <span class="kw">true</span><span class="op">},</span></a>
<a class="sourceLine" id="cb3-7" title="7">        <span class="dt">handlers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb3-8" title="8">            <span class="dt">onInputHeaderChange</span><span class="op">:</span> <span class="st">&quot;search&quot;</span></a>
<a class="sourceLine" id="cb3-9" title="9">        <span class="op">},</span></a>
<a class="sourceLine" id="cb3-10" title="10">        <span class="dt">search</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb3-11" title="11">            <span class="at">alert</span>(<span class="va">inEvent</span>.<span class="va">originator</span>.<span class="at">get</span>(<span class="st">&quot;value&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb3-12" title="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb3-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Looking at <code>flickr.SearchPanel</code>, we see that it accepts input in the header and catches the <code>onInputHeaderChange</code> event that’s generated, using a handler method called <code>search()</code>. We’ll eventually use this method to fetch search results from the Flickr API.</p>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>headerOptions</strong> - Internally, <code>moon.Panel</code> contains a <a href="../..//#/kind/moon.Header">moon.Header</a> as part of its “chrome” (a term we use to refer to controls contained within another kind, which are not accessible to the <em>user</em> of the kind). Many common properties of <code>moon.Header</code>, such as <code>title</code>, <code>titleBelow</code>, and so on, are brought forward as properties on <code>moon.Panel</code> for convenience. If there are other properties of the header that you would like to configure, you can set them on a <code>headerOptions</code> property.</p>
<ul>
<li><p><strong>inputMode</strong> - Configures the header to allow typing in the title area.</p></li>
<li><p><strong>dismissOnEnter</strong> - Configures the input in the header to blur the input (and dismiss any virtual keyboard) when the user presses <strong>Enter</strong>.</p></li>
</ul></li>
<li><p><strong>handlers</strong></p>
<ul>
<li><p>The <code>handlers</code> block catches events bubbled from this kind or any of its children. Here we set up this kind to call its <code>search()</code> function when <code>onInputHeaderChange</code> is caught.</p></li>
<li><p><code>onInputHeaderChange</code> is an event bubbled from <code>moon.Panel</code>’s internal <code>moon.Header</code> when the input value changes, e.g., when the user presses <strong>Enter</strong> or the input loses keyboard focus.</p></li>
</ul></li>
<li><p><strong>search()</strong></p>
<p>Note the signature of the handler function. <code>search()</code> takes two arguments: <code>inSender</code> and <code>inEvent</code>. This is a common signature for all Enyo event handlers. <code>inSender</code> is a reference to the last control that bubbled the event–in this case, the <code>flickr.SearchPanel</code> instance itself. <code>inEvent</code> contains any information related to the event, including the <code>originator</code>, a reference to the control that initially bubbled the event (i.e., the header inside the panel).</p></li>
<li><p>By calling <code>inEvent.originator.get("value")</code>, we can retrieve the current value of the input from the <code>value</code> property on <code>moon.Header</code>. For now, we just display the value in an alert to make sure everything is working properly.</p></li>
</ul>
<p>Returning to <code>flickr.MainView</code>, we’ll use our new <code>flickr.SearchPanel</code> as the first panel in the main view’s <code>moon.Panels</code>, replacing the generic <code>moon.Panel</code> that we declared in Step 4.</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb4-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb4-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.MainView&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-3" title="3">        <span class="dt">classes</span><span class="op">:</span> <span class="st">&quot;moon enyo-fit&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb4-4" title="4">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb4-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panels&quot;</span><span class="op">,</span> <span class="dt">classes</span><span class="op">:</span> <span class="st">&quot;enyo-fit&quot;</span><span class="op">,</span> <span class="dt">pattern</span><span class="op">:</span> <span class="st">&quot;alwaysviewing&quot;</span><span class="op">,</span> <span class="dt">popOnBack</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb4-6" title="6">                <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">}</span>  <span class="co">// Use our new flickr.SearchPanel</span></a>
<a class="sourceLine" id="cb4-7" title="7">            ]<span class="op">}</span></a>
<a class="sourceLine" id="cb4-8" title="8">        ]</a>
<a class="sourceLine" id="cb4-9" title="9">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong><a href="http://jsfiddle.net/enyojs/d7dr3/">View the code and results of Step 5 in JSFiddle</a></strong></p>
<h2 id="add-a-grid-to-the-search-panel">6. Add a grid to the search panel</h2>
<p>Next, let’s add a <a href="../..//#/kind/moon.DataGridList">moon.DataGridList</a> to the search panel. We’ll use this to display thumbnails of the search results.</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb5-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb5-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span> </a>
<a class="sourceLine" id="cb5-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-4" title="4">        <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Search Flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-5" title="5">        <span class="dt">titleBelow</span><span class="op">:</span> <span class="st">&quot;Enter search term above&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb5-6" title="6">        <span class="dt">headerOptions</span><span class="op">:</span> <span class="op">{</span><span class="dt">inputMode</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">dismissOnEnter</span><span class="op">:</span> <span class="kw">true</span><span class="op">},</span></a>
<a class="sourceLine" id="cb5-7" title="7">        <span class="dt">handlers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb5-8" title="8">            <span class="dt">onInputHeaderChange</span><span class="op">:</span> <span class="st">&quot;search&quot;</span></a>
<a class="sourceLine" id="cb5-9" title="9">        <span class="op">},</span></a>
<a class="sourceLine" id="cb5-10" title="10">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb5-11" title="11">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.DataGridList&quot;</span><span class="op">,</span> <span class="dt">fit</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;resultList&quot;</span><span class="op">,</span> <span class="dt">minWidth</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span> <span class="dt">minHeight</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span> <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb5-12" title="12">                <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.GridListImageItem&quot;</span><span class="op">,</span> <span class="dt">imageSizing</span><span class="op">:</span> <span class="st">&quot;cover&quot;</span><span class="op">,</span> <span class="dt">useSubCaption</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">centered</span><span class="op">:</span> <span class="kw">false</span><span class="op">}</span></a>
<a class="sourceLine" id="cb5-13" title="13">            ]<span class="op">}</span></a>
<a class="sourceLine" id="cb5-14" title="14">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb5-15" title="15">        <span class="dt">search</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb5-16" title="16">            <span class="at">alert</span>(<span class="va">inEvent</span>.<span class="va">originator</span>.<span class="at">get</span>(<span class="st">&quot;value&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb5-17" title="17">        <span class="op">}</span></a>
<a class="sourceLine" id="cb5-18" title="18">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Here we’ve added a <code>components</code> block, the contents of which are placed under the header inside of the panel. Within the <code>components</code> block, we have a <code>moon.DataGridList</code>, which has a <a href="../..//#/kind/moon.GridListImageItem">moon.GridListImageItem</a> that serves as the list template that is repeated for each model.</p>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>moon.DataGridList</strong></p>
<ul>
<li><p><strong>fit: true</strong> - Note that the <code>moon.DataGridList</code> instance has its <code>fit</code> property set to <code>true</code>. By default, <code>moon.Panel</code> lays out the child components under the header using <a href="../..//#/kind/enyo.FittableRowsLayout">enyo.FittableRowsLayout</a>. That layoutKind causes one component with <code>fit: true</code> to be resized to take up any remaining space left by the other components. In this case, since the grid list is the only component, it will expand to fill the entire space under the header.</p></li>
<li><p><strong>minWidth</strong> and <strong>minHeight</strong> - <code>moon.DataGridList</code> lays out and sizes its child components in a grid according to the <code>minWidth</code> and <code>minHeight</code> (and <code>spacing</code>) properties. The grid uses a “fixed-spacing” algorithm that ensures there is no unused whitespace in the grid area by starting with the minimum size specified, and then scaling up the size of the items to completely fill a row, while maintaining the aspect ratio of the original minimum size. This ensures that grids are uniformly spaced with no unwanted whitespace, regardless of the size of the grid area.</p></li>
</ul></li>
<li><p><strong>moon.GridListImageItem</strong> - For details on the options passed to this control, see the <a href="../..//#/kind/moon.GridListImageItem">API docs</a>.</p></li>
</ul>
<p>If you try running the app after these changes, you shouldn’t see any changes from the previous step. That’s because the DataGridList requires data in order to render items; right now, we have none. In the next step, we’ll rectify this situation.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/45Zn4/">View the code and results of Step 6 in JSFiddle</a></strong></p>
<h2 id="bind-a-data-collection-to-the-grid">7. Bind a data collection to the grid</h2>
<p>As we’ve just seen, a DataGridList requires a collection of data to drive the set of items rendered in the list. <a href="../..//#/kind/enyo.Collection">enyo.Collection</a> is a subkind of <a href="../..//#/kind/enyo.Component">enyo.Component</a> that provides an array-like data structure for handling instances of <a href="../..//#/kind/enyo.Model">enyo.Model</a>, with support for observing additions to and deletions from the array. The <code>DataGridList</code> will render one instance of the controls in its <code>components</code> block for each model contained in the collection. The model will then be set to the <code>model</code> property of the top-level control for each item, and bindings from the <code>model</code> property into the view properties will control how data from each model is represented in the view.</p>
<p><strong>For your information:</strong> If you’re interested in a complete overview of Enyo’s data-layer features, including bindings, observers, computed properties, models, collections, and data-aware controls (such as DataGridList), see <a href="../building-apps/managing-data/building-data-driven-apps.html">Building Data-Driven Apps</a>.</p>
<p>To make this grid go, first we’ll create a generic <code>enyo.Collection</code> when the panel is instantiated by overriding the <code>SearchPanel</code> control’s <code>create()</code> method. We set the new collection as the value of an instance variable on the control, which we’ll call “photos”:</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb6-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb6-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb6-3" title="3">        ...</a>
<a class="sourceLine" id="cb6-4" title="4">        <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb6-5" title="5">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb6-6" title="6">            <span class="kw">this</span>.<span class="at">set</span>(<span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="va">enyo</span>.<span class="at">Collection</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb6-7" title="7">        <span class="op">}</span></a>
<a class="sourceLine" id="cb6-8" title="8">        ...</a>
<a class="sourceLine" id="cb6-9" title="9">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Next, we’ll add a binding from that instance variable to the <code>collection</code> property of our DataGridList:</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb7-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb7-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb7-3" title="3">        ...</a>
<a class="sourceLine" id="cb7-4" title="4">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb7-5" title="5">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;$.resultList.collection&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb7-6" title="6">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb7-7" title="7">        ...</a>
<a class="sourceLine" id="cb7-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Then we’ll add bindings from the <code>model</code> property on GridListImageItem (which, you may recall, will be retrieved from the collection and set on each item by the DataGridList) to properties on the <code>GridListImageItem</code>. Note that this assumes each model will have a schema that includes properties named <code>title</code> and <code>thumbnail</code>.</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb8-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb8-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb8-3" title="3">        ...</a>
<a class="sourceLine" id="cb8-4" title="4">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb8-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.DataGridList&quot;</span><span class="op">,</span> ...<span class="op">,</span> <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb8-6" title="6">                <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.GridListImageItem&quot;</span><span class="op">,</span> ...<span class="op">,</span> <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb8-7" title="7">                    <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.title&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;caption&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb8-8" title="8">                    <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.thumbnail&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;source&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb8-9" title="9">                ]<span class="op">}</span></a>
<a class="sourceLine" id="cb8-10" title="10">            ]<span class="op">}</span></a>
<a class="sourceLine" id="cb8-11" title="11">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb8-12" title="12">        ...</a>
<a class="sourceLine" id="cb8-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Finally, let’s give our new collection some placeholder data, to make sure it’s all hooked up correctly. We’ll remove this once we have actual data fetched from Flickr to use.</p>
<p><strong>Edit file: source/views/views.js</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb9-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb9-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb9-3" title="3">        ...</a>
<a class="sourceLine" id="cb9-4" title="4">        <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb9-5" title="5">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb9-6" title="6">            <span class="kw">this</span>.<span class="at">set</span>(<span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="va">enyo</span>.<span class="at">Collection</span>([</a>
<a class="sourceLine" id="cb9-7" title="7">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 1&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?1&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb9-8" title="8">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 2&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?2&quot;</span><span class="op">},</span>            </a>
<a class="sourceLine" id="cb9-9" title="9">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 3&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?3&quot;</span><span class="op">},</span>           </a>
<a class="sourceLine" id="cb9-10" title="10">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 4&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?4&quot;</span><span class="op">}</span>            </a>
<a class="sourceLine" id="cb9-11" title="11">            ]))<span class="op">;</span></a>
<a class="sourceLine" id="cb9-12" title="12">        <span class="op">},</span></a>
<a class="sourceLine" id="cb9-13" title="13">        ...</a>
<a class="sourceLine" id="cb9-14" title="14">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>The final <code>flickr.SearchPanel</code> implementation for this step should look like this:</p>
<p><strong>File: source/views/views.js</strong></p>
<div class="sourceCode" id="cb10"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb10-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb10-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-4" title="4">        <span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Search Flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-5" title="5">        <span class="dt">titleBelow</span><span class="op">:</span> <span class="st">&quot;Enter search term above&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb10-6" title="6">        <span class="dt">headerOptions</span><span class="op">:</span> <span class="op">{</span><span class="dt">inputMode</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">dismissOnEnter</span><span class="op">:</span> <span class="kw">true</span><span class="op">},</span></a>
<a class="sourceLine" id="cb10-7" title="7">        <span class="dt">handlers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb10-8" title="8">            <span class="dt">onInputHeaderChange</span><span class="op">:</span> <span class="st">&quot;search&quot;</span></a>
<a class="sourceLine" id="cb10-9" title="9">        <span class="op">},</span></a>
<a class="sourceLine" id="cb10-10" title="10">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb10-11" title="11">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.DataGridList&quot;</span><span class="op">,</span> <span class="dt">fit</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;resultList&quot;</span><span class="op">,</span> <span class="dt">minWidth</span><span class="op">:</span> <span class="dv">250</span><span class="op">,</span> <span class="dt">minHeight</span><span class="op">:</span> <span class="dv">300</span><span class="op">,</span> <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb10-12" title="12">                <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.GridListImageItem&quot;</span><span class="op">,</span> <span class="dt">imageSizing</span><span class="op">:</span> <span class="st">&quot;cover&quot;</span><span class="op">,</span> <span class="dt">useSubCaption</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">centered</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span> <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb10-13" title="13">                    <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.title&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;caption&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb10-14" title="14">                    <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.thumbnail&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;source&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb10-15" title="15">                ]<span class="op">}</span></a>
<a class="sourceLine" id="cb10-16" title="16">            ]<span class="op">}</span></a>
<a class="sourceLine" id="cb10-17" title="17">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb10-18" title="18">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb10-19" title="19">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;$.resultList.collection&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb10-20" title="20">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb10-21" title="21">        <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb10-22" title="22">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb10-23" title="23">            <span class="kw">this</span>.<span class="at">set</span>(<span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="va">enyo</span>.<span class="at">Collection</span>([</a>
<a class="sourceLine" id="cb10-24" title="24">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 1&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?1&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb10-25" title="25">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 2&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?2&quot;</span><span class="op">},</span>            </a>
<a class="sourceLine" id="cb10-26" title="26">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 3&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?3&quot;</span><span class="op">},</span>           </a>
<a class="sourceLine" id="cb10-27" title="27">                <span class="op">{</span><span class="dt">title</span><span class="op">:</span> <span class="st">&quot;Photo 4&quot;</span><span class="op">,</span> <span class="dt">thumbnail</span><span class="op">:</span> <span class="st">&quot;http://lorempixel.com/300/300/?4&quot;</span><span class="op">}</span>            </a>
<a class="sourceLine" id="cb10-28" title="28">            ]))<span class="op">;</span></a>
<a class="sourceLine" id="cb10-29" title="29">        <span class="op">},</span></a>
<a class="sourceLine" id="cb10-30" title="30">        <span class="dt">search</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb10-31" title="31">            <span class="at">alert</span>(<span class="va">inEvent</span>.<span class="va">originator</span>.<span class="at">get</span>(<span class="st">&quot;value&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb10-32" title="32">        <span class="op">}</span></a>
<a class="sourceLine" id="cb10-33" title="33">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>create()</strong> - The <code>create()</code> function is called as part of every component’s lifecycle. Superkinds of your controls will also have their <code>create()</code> functions called, so it is important to always call the superkind’s implementation by calling <code>enyo.inherited(arguments);</code>. This is a standard way of calling the supermethod. You can read more about the Enyo component lifecycle in <a href="../key-concepts/kinds.html">Kinds</a>, <a href="../key-concepts/components.html">Components</a>, and <a href="../key-concepts/controls.html">Controls</a>.</p></li>
<li><p><strong>enyo.Collection</strong> - A collection may get its data statically, from a passed-in array of records, or dynamically, from a call to the <code>fetch()</code> API on the collection. At the moment, we’re just using static data.</p></li>
</ul>
<p><strong><a href="http://jsfiddle.net/enyojs/D4qAD/">View the code and results of Step 7 in JSFiddle</a></strong></p>
<h2 id="create-a-data-source-for-the-flickr-api">8. Create a data source for the Flickr API</h2>
<p>Dummy data does not make for an interesting app, so in the next few steps, we’ll start making custom data-related kinds for interacting with the Flickr API. In this step, we’ll build a subkind of <a href="../..//#/kind/enyo.Source">enyo.Source</a> to fetch data from Flickr.</p>
<p>Enyo provides a layered approach to defining logic specific to fetching, committing changes, and deleting records from back-end data sources. At the foundation, these are based on <code>enyo.Source</code>, which implements an abstract API for the <code>fetch</code>, <code>commit</code>, <code>find</code>, and <code>destroy</code> operations common to all collections and models you’ll retrieve from a given back-end. Subkinds of <code>enyo.Collection</code> and <code>enyo.Model</code> may then specify a default data source to perform these operations, fetching/committing/destroying data in the collection or model on behalf of itself, often by passing properties on the model or collection subkind that provide the source with information about how to retrieve the data. A model or collection may also provide overrides for any of these operations on a case-by-case basis as needed.</p>
<p>Enyo provides two concrete data sources by default, one for fetching data from an Ajax source using XHR (<a href="../..//#/kind/enyo.AjaxSource">enyo.AjaxSource</a>) and one for fetching data from a Jsonp source (<a href="../..//#/kind/enyo.JsonpSource">enyo.JsonpSource</a>). Both of these sources assume a REST interface by default, but may be customized.</p>
<p>We will be using Flickr’s Jsonp Web services; this will make testing in the browser easier, since Jsonp lets us avoid the cross-origin security restrictions that browsers implement. As such, our source will extend <code>enyo.JsonpSource</code>.</p>
<p>First, we’ll create a <code>flickr.Source</code> subkind that sets the <code>urlRoot</code> property, which <code>enyo.JsonpSource</code> uses as the base URL for making requests. This URL is common to all requests to the Flickr API, so it makes sense to specify it on the source directly:</p>
<p><strong>Add to file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb11-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb11-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.Source&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.JsonpSource&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-4" title="4">        <span class="dt">urlRoot</span><span class="op">:</span> <span class="st">&quot;https://api.flickr.com/services/rest/&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb11-5" title="5">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Next, let’s override the fetch/commit/destroy API that <code>enyo.JsonpSource</code> provides to better suit our needs. Since we’ll be utilizing read-only portions of the API, we only need to override the <code>fetch()</code> function.</p>
<p>Specifically, we’ll take the <code>opts</code> object used by <code>enyo.JsonpSource</code>’s <code>fetch()</code> implementation and add properties that all Flickr requests will need. This includes customizing the <code>callbackName</code> property to match the one expected by Flickr’s API. We’ll also set the <code>api_key</code> and <code>format</code> keys on the <code>params</code> hash, which will be expanded into query string parameters on the Jsonp request.</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb12"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb12-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb12-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.Source&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.JsonpSource&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-4" title="4">        <span class="dt">urlRoot</span><span class="op">:</span> <span class="st">&quot;https://api.flickr.com/services/rest/&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb12-5" title="5">        <span class="dt">fetch</span><span class="op">:</span> <span class="kw">function</span>(rec<span class="op">,</span> opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb12-6" title="6">            <span class="va">opts</span>.<span class="at">callbackName</span> <span class="op">=</span> <span class="st">&quot;jsoncallback&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-7" title="7">            <span class="va">opts</span>.<span class="at">params</span> <span class="op">=</span> <span class="op">{};</span></a>
<a class="sourceLine" id="cb12-8" title="8">            <span class="va">opts</span>.<span class="va">params</span>.<span class="at">api_key</span> <span class="op">=</span> <span class="st">&quot;2a21b46e58d207e4888e1ece0cb149a5&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-9" title="9">            <span class="va">opts</span>.<span class="va">params</span>.<span class="at">format</span> <span class="op">=</span> <span class="st">&quot;json&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb12-10" title="10">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb12-11" title="11">        <span class="op">}</span></a>
<a class="sourceLine" id="cb12-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Last, we need to register our newly-created source, to make it available for use by models and collections:</p>
<p><strong>Add to bottom of file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb13-1" title="1">   <span class="kw">new</span> <span class="va">flickr</span>.<span class="at">Source</span>(<span class="op">{</span><span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr&quot;</span><span class="op">}</span>)<span class="op">;</span> </a></code></pre></div>
<p>For more details on the properties available for configuring this source, refer to the API documentation for <a href="../..//#/kind/enyo.JsonpSource">enyo.JsonpSource</a> and <a href="../..//#/kind/enyo.JsonpRequest">enyo.JsonpRequest</a>. The latter kind is used internally by <code>enyo.JsonpSource</code>, and is configured by properties on the <code>opts</code> hash.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/65hr7/">View the code and results of Step 8 in JSFiddle</a></strong></p>
<h2 id="create-a-collection-subkind-for-searching">9: Create a collection subkind for searching</h2>
<p>Next, we’ll create a subkind of <code>enyo.Collection</code> that uses our new <code>flickr.Source</code> to fetch a collection of image records based on search text that we give it.</p>
<p>We’ll start with a basic subkind, and tell it to use the <code>flickr.Source</code> by default:</p>
<p><strong>Add to file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb14-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb14-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchCollection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.Collection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb14-4" title="4">        <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;flickr&quot;</span></a>
<a class="sourceLine" id="cb14-5" title="5">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><em>Note:</em> We use the name we registered for the source as the value of <code>source</code>.</p>
<p>Next, we’ll add a published property called <code>searchText</code>, and a <code>searchTextChanged</code> handler, which will destroy any previously fetched records and then fetch more. <code>searchTextChanged</code> will be called automatically whenever the value of <code>searchText</code> is altered.</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb15"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb15-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb15-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchCollection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.Collection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-4" title="4">        <span class="dt">model</span><span class="op">:</span> <span class="st">&quot;flickr.ImageModel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-5" title="5">        <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb15-6" title="6">        <span class="dt">published</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb15-7" title="7">            <span class="dt">searchText</span><span class="op">:</span> <span class="kw">null</span></a>
<a class="sourceLine" id="cb15-8" title="8">        <span class="op">},</span></a>
<a class="sourceLine" id="cb15-9" title="9">        <span class="dt">searchTextChanged</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb15-10" title="10">            <span class="kw">this</span>.<span class="at">empty</span>(<span class="op">{</span><span class="dt">destroy</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb15-11" title="11">            <span class="kw">this</span>.<span class="at">fetch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb15-12" title="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb15-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Finally, we’ll override the collection’s <code>fetch()</code> function to provide more information to the source about how to retrieve this specific information. Along with the search text, the <a href="https://www.flickr.com/services/api/flickr.photos.search.html">Flickr photos search API</a> requires us to pass a <code>method</code> query string parameter indicating that we want to search photos. There are a number of optional parameters we could specify as well; for this sample, we’ll specify a <code>sort</code> value (so that we get interesting photos), and a limit to the number of results.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb16-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb16-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchCollection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.Collection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-4" title="4">        <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-5" title="5">        <span class="dt">published</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-6" title="6">            <span class="dt">searchText</span><span class="op">:</span> <span class="kw">null</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-7" title="7">        <span class="op">},</span></a>
<a class="sourceLine" id="cb16-8" title="8">        <span class="dt">searchTextChanged</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb16-9" title="9">            <span class="kw">this</span>.<span class="at">empty</span>(<span class="op">{</span><span class="dt">destroy</span><span class="op">:</span> <span class="kw">true</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-10" title="10">            <span class="kw">this</span>.<span class="at">fetch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb16-11" title="11">        <span class="op">},</span></a>
<a class="sourceLine" id="cb16-12" title="12">        <span class="dt">fetch</span><span class="op">:</span> <span class="kw">function</span>(opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb16-13" title="13">            <span class="kw">this</span>.<span class="at">params</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb16-14" title="14">                <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;flickr.photos.search&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-15" title="15">                <span class="dt">sort</span><span class="op">:</span> <span class="st">&quot;interestingness-desc&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-16" title="16">                <span class="dt">per_page</span><span class="op">:</span> <span class="dv">50</span><span class="op">,</span></a>
<a class="sourceLine" id="cb16-17" title="17">                <span class="dt">text</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">searchText</span></a>
<a class="sourceLine" id="cb16-18" title="18">            <span class="op">};</span></a>
<a class="sourceLine" id="cb16-19" title="19">            <span class="cf">return</span> <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb16-20" title="20">        <span class="op">}</span></a>
<a class="sourceLine" id="cb16-21" title="21">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Ultimately, the search parameters need to be added to the <code>params</code> hash that our <code>flickr.Source</code> passes on to the <code>JsonpRequest</code>. You’ll notice above that we set these in a <code>params</code> hash on the collection; we’ll update the source to look for these parameters and add them to the <code>params</code> that are passed along:</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb17"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb17-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb17-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.Source&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.JsonpSource&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-4" title="4">        <span class="dt">urlRoot</span><span class="op">:</span> <span class="st">&quot;https://api.flickr.com/services/rest/&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb17-5" title="5">        <span class="dt">fetch</span><span class="op">:</span> <span class="kw">function</span>(rec<span class="op">,</span> opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb17-6" title="6">            <span class="va">opts</span>.<span class="at">callbackName</span> <span class="op">=</span> <span class="st">&quot;jsoncallback&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-7" title="7">            <span class="va">opts</span>.<span class="at">params</span> <span class="op">=</span> <span class="va">enyo</span>.<span class="at">clone</span>(<span class="va">rec</span>.<span class="at">params</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-8" title="8">            <span class="va">opts</span>.<span class="va">params</span>.<span class="at">api_key</span> <span class="op">=</span> <span class="st">&quot;2a21b46e58d207e4888e1ece0cb149a5&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-9" title="9">            <span class="va">opts</span>.<span class="va">params</span>.<span class="at">format</span> <span class="op">=</span> <span class="st">&quot;json&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb17-10" title="10">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb17-11" title="11">        <span class="op">}</span></a>
<a class="sourceLine" id="cb17-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Note that we’ve assigned <code>opts.params</code> to a clone of the <code>params</code> that exist on the <code>rec</code> property (which is a reference to the model/collection being fetched), and then added the source parameters to it. In this way, we combine parameters specific to the <code>flickr.SearchCollection</code> with parameters that apply to all Flickr requests that we define on <code>flickr.Source</code>–implementing a layered approach that lets us avoid repeating ourselves.</p>
<p>At this point, if we call <code>set("searchText", "San Francisco")</code> on an instance of our <code>flickr.SearchCollection</code>, we should get result data loaded into the collection. But there is one final step.</p>
<p>If we look at a sample of the <a href="https://api.flickr.com/services/rest/?method=flickr.photos.search&amp;sort=interestingness-desc&amp;per_page=50&amp;text=San%20Francisco&amp;api_key=2a21b46e58d207e4888e1ece0cb149a5&amp;format=json&amp;jsoncallback=enyo_jsonp_callback_0">data returned</a> from a call to the API, we can see that it is not actually an array, which is what <code>enyo.Collection</code> expects. The array of photo records is actually nested a couple levels down in the object returned:</p>
<p><strong>Sample response from Flickr “flickr.photos.search” API</strong></p>
<pre><code>    {
        &quot;photos&quot;: {
            &quot;page&quot;: 1,
            &quot;pages&quot;: 171118,
            &quot;perpage&quot;: 50,
            &quot;total&quot;: &quot;8555851&quot;,
            &quot;photo&quot;: [
                {
                    &quot;id&quot;: &quot;8866167062&quot;,
                    &quot;owner&quot;: &quot;23101599@N03&quot;,
                    &quot;secret&quot;: &quot;2a48819a28&quot;,
                    &quot;server&quot;: &quot;3748&quot;,
                    &quot;farm&quot;: 4,
                    &quot;title&quot;: &quot;My Wife and The Union Jack&quot;,
                    &quot;ispublic&quot;: 1,
                    &quot;isfriend&quot;: 0,
                    &quot;isfamily&quot;: 0
                },
                {
                    &quot;id&quot;: &quot;8589709770&quot;,
                    &quot;owner&quot;: &quot;72199305@N00&quot;,
                    &quot;secret&quot;: &quot;77042e76b3&quot;,
                    &quot;server&quot;: &quot;8237&quot;,
                    &quot;farm&quot;: 9,
                    &quot;title&quot;: &quot;Into the Fog&quot;,
                    &quot;ispublic&quot;: 1,
                    &quot;isfriend&quot;: 0,
                    &quot;isfamily&quot;: 0
                },
                ...
            ]
        }
    }</code></pre>
<p>To deal with this, Enyo provides a <code>parse()</code> function that allows us to transform data retrieved from the server into data appropriate for our specific collections and models. In our implementation of <code>parse()</code>, we simply take the passed-in <code>data</code> argument (which reflects the raw data received) and return the array that we actually want to load into the collection–which, in this case, is <code>data.photos.photo</code>:</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb19-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb19-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchCollection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb19-3" title="3">        ...</a>
<a class="sourceLine" id="cb19-4" title="4">        <span class="dt">options</span><span class="op">:</span> <span class="op">{</span> <span class="dt">parse</span><span class="op">:</span> <span class="kw">true</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb19-5" title="5">        ...</a>
<a class="sourceLine" id="cb19-6" title="6">        <span class="dt">parse</span><span class="op">:</span> <span class="kw">function</span>(data) <span class="op">{</span></a>
<a class="sourceLine" id="cb19-7" title="7">            <span class="cf">return</span> data <span class="op">&amp;&amp;</span> <span class="va">data</span>.<span class="at">photos</span> <span class="op">&amp;&amp;</span> <span class="va">data</span>.<span class="va">photos</span>.<span class="at">photo</span><span class="op">;</span></a>
<a class="sourceLine" id="cb19-8" title="8">        <span class="op">}</span></a>
<a class="sourceLine" id="cb19-9" title="9">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><em>Note:</em> By default, Enyo will not call the <code>parse</code> method unless you set the <code>parse</code> option to <code>true</code>.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/PLqj6/">View the code and results of Step 9 in JSFiddle</a></strong></p>
<h2 id="create-a-model-subkind-for-image-records">10: Create a model subkind for image records</h2>
<p>There’s one last piece we need before we can hook everything up and see it all in action. That’s an <code>enyo.Model</code> subkind to wrap the records that are fetched by our <code>flickr.SearchCollection</code>. To be clear, <code>enyo.Collection</code> doesn’t <em>require</em> a custom subkind of <code>enyo.Model</code>; it will default to wrapping the individual objects of the array it receives, with a generic <code>enyo.Model</code>, allowing the properties on the records to be bindable using Enyo’s bindings.</p>
<p>Looking again at the data returned from the Flickr API, we discover something interesting–the data doesn’t include a URL for the image!</p>
<pre><code>    [
        {
            &quot;id&quot;: &quot;8866167062&quot;,
            &quot;owner&quot;: &quot;23101599@N03&quot;,
            &quot;secret&quot;: &quot;2a48819a28&quot;,
            &quot;server&quot;: &quot;3748&quot;,
            &quot;farm&quot;: 4,
            &quot;title&quot;: &quot;My Wife and The Union Jack&quot;,
            &quot;ispublic&quot;: 1,
            &quot;isfriend&quot;: 0,
            &quot;isfamily&quot;: 0
        },
        {
            &quot;id&quot;: &quot;8589709770&quot;,
            &quot;owner&quot;: &quot;72199305@N00&quot;,
            &quot;secret&quot;: &quot;77042e76b3&quot;,
            &quot;server&quot;: &quot;8237&quot;,
            &quot;farm&quot;: 9,
            &quot;title&quot;: &quot;Into the Fog&quot;,
            &quot;ispublic&quot;: 1,
            &quot;isfriend&quot;: 0,
            &quot;isfamily&quot;: 0
        },
        ...
    ]</code></pre>
<p>Since we want to present a grid of images found by the search, this is a problem. It turns out that Flickr requires you to construct the URL from the data returned, according to a <a href="http:s//www.flickr.com/services/api/misc.urls.html">scheme documented in their API guide</a>. Essentially, the URL is assembled as follows:</p>
<pre><code>    https://farm{farm-id}.staticflickr.com/{server-id}/{id}_{secret}_[mstzb].jpg</code></pre>
<p>where <code>[mstzb]</code> indicates a size option. To accommodate this, we’ll create a subkind of <code>enyo.Model</code> that uses computed properties to dynamically build a <code>thumbnail</code> URL and an <code>original</code> URL, based on other properties contained in the model data:</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb22-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb22-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.ImageModel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.Model&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb22-4" title="4">        <span class="dt">computed</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb22-5" title="5">            <span class="op">{</span><span class="dt">method</span><span class="op">:</span> <span class="st">&quot;thumbnail&quot;</span><span class="op">,</span> <span class="dt">path</span><span class="op">:</span> [<span class="st">&quot;farm&quot;</span><span class="op">,</span> <span class="st">&quot;server&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">,</span> <span class="st">&quot;secret&quot;</span>]<span class="op">},</span></a>
<a class="sourceLine" id="cb22-6" title="6">            <span class="op">{</span><span class="dt">method</span><span class="op">:</span> <span class="st">&quot;original&quot;</span><span class="op">,</span> <span class="dt">path</span><span class="op">:</span> [<span class="st">&quot;farm&quot;</span><span class="op">,</span> <span class="st">&quot;server&quot;</span><span class="op">,</span> <span class="st">&quot;id&quot;</span><span class="op">,</span> <span class="st">&quot;secret&quot;</span>]<span class="op">}</span></a>
<a class="sourceLine" id="cb22-7" title="7">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb22-8" title="8">        <span class="dt">thumbnail</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb22-9" title="9">            <span class="cf">return</span> <span class="st">&quot;https://farm&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;farm&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-10" title="10">                <span class="st">&quot;.static.flickr.com/&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;server&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-11" title="11">                <span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;id&quot;</span>) <span class="op">+</span> <span class="st">&quot;_&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;secret&quot;</span>) <span class="op">+</span> <span class="st">&quot;_m.jpg&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-12" title="12">        <span class="op">},</span></a>
<a class="sourceLine" id="cb22-13" title="13">        <span class="dt">original</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb22-14" title="14">            <span class="cf">return</span> <span class="st">&quot;https://farm&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;farm&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-15" title="15">                <span class="st">&quot;.static.flickr.com/&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;server&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb22-16" title="16">                <span class="st">&quot;/&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;id&quot;</span>) <span class="op">+</span> <span class="st">&quot;_&quot;</span> <span class="op">+</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;secret&quot;</span>) <span class="op">+</span> <span class="st">&quot;.jpg&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb22-17" title="17">        <span class="op">}</span></a>
<a class="sourceLine" id="cb22-18" title="18">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><strong>computed</strong> - The <code>computed</code> array lets us define computed properties and their dependencies. Here, we provide the <code>thumbnail</code> and <code>original</code> properties, computed according to Flickr’s URL schemes. These properties will be bindable to our view, just like static properties retrieved from the server, such as <code>title</code>. If any dependent property specified in the array (<code>farm</code>, <code>server</code>, <code>id</code>, or <code>secret</code>) changes, any bindings to the property will be notified and re-synced. In this sample, we won’t be changing the dependent properties after they are fetched from the server, but if we did, they would update automatically. Very handy.</li>
</ul>
<p>Last, we’ll tell our <code>flickr.SearchCollection</code> to wrap all records fetched, using our new <code>flickr.ImageModel</code> (rather than the default <code>enyo.Model</code>) by specifying the <code>model</code> property on the collection:</p>
<p><strong>Edit file: source/data/data.js</strong></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb23-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb23-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchCollection&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb23-3" title="3">        ...</a>
<a class="sourceLine" id="cb23-4" title="4">        <span class="dt">model</span><span class="op">:</span> <span class="st">&quot;flickr.ImageModel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb23-5" title="5">        ...</a>
<a class="sourceLine" id="cb23-6" title="6">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong><a href="http://jsfiddle.net/enyojs/8uvJE/">View the code and results of Step 10 in JSFiddle</a></strong></p>
<h2 id="connect-the-input-collection-and-grid">11: Connect the input, collection, and grid</h2>
<p>At last, it’s time to see all of our hard work in action. To recap what we’ve done so far:</p>
<ul>
<li><p>We created a <code>flickr.SearchPanel</code> that has a <code>search</code> handler function that fires when the input header’s text changes.</p></li>
<li><p>We added a <code>moon.DataGridList</code> to the search panel, which gets its data from a generic collection with dummy data.</p></li>
<li><p>We created <code>flickr.Source</code>, <code>flickr.Collection</code>, and <code>flickr.ImageModel</code> subkinds for fetching image models from the Flickr API’s search endpoint.</p></li>
</ul>
<p>So, let’s hook these pieces together. First, in our <code>flickr.SearchPanel</code>, we’ll set the grid list’s collection type to be our new <code>flickr.SearchCollection</code>:</p>
<p><strong>Edit file: source/view/views.js</strong></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb24-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb24-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb24-3" title="3">        ...</a>
<a class="sourceLine" id="cb24-4" title="4">        <span class="dt">create</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb24-5" title="5">            <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb24-6" title="6">            <span class="kw">this</span>.<span class="at">set</span>(<span class="st">&quot;photos&quot;</span><span class="op">,</span> <span class="kw">new</span> <span class="va">flickr</span>.<span class="at">SearchCollection</span>())<span class="op">;</span></a>
<a class="sourceLine" id="cb24-7" title="7">        <span class="op">}</span></a>
<a class="sourceLine" id="cb24-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Next, when the <code>search</code> input change handler fires, we’ll set the input text to the search collection’s <code>searchText</code> property:</p>
<p><strong>Edit file: source/view/views.js</strong></p>
<div class="sourceCode" id="cb25"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb25-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb25-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb25-3" title="3">        ...</a>
<a class="sourceLine" id="cb25-4" title="4">        <span class="dt">search</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb25-5" title="5">            <span class="kw">this</span>.<span class="va">$</span>.<span class="va">resultList</span>.<span class="va">collection</span>.<span class="at">set</span>(<span class="st">&quot;searchText&quot;</span><span class="op">,</span> <span class="va">inEvent</span>.<span class="va">originator</span>.<span class="at">get</span>(<span class="st">&quot;value&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb25-6" title="6">        <span class="op">}</span></a>
<a class="sourceLine" id="cb25-7" title="7">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You may recall that setting <code>searchText</code> kicks off a fetch of the <code>flickr.SearchCollection</code> via the <code>flickr</code> source, using the parameters passed from the collection. When the collection gets its data, each record will be wrapped in our <code>flickr.ImageModel</code>, and the <code>moon.DataGridList</code> will be notified that new models were added to its <code>collection</code> property. The grid list will render an instance of <code>moon.GridListImageItem</code> controls for each model, and will use the bindings we set up from the <code>title</code> attribute and <code>thumbnail</code> computed property to update each item’s view properties. And that’s it! We now have a functioning search panel.</p>
<p>Try it out by typing something into the input in the header and pressing <strong>Enter</strong>. You should see a list of images corresponding to your search text.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/ktXWd/">View the code and results of Step 11 in JSFiddle</a></strong></p>
<h2 id="add-a-loading-spinner-to-search-panel">12. Add a loading spinner to search panel</h2>
<p>The Flickr API may take a bit of time to return the results of the search, so we’ll add a <a href="../..//#/kind/moon.Spinner">moon.Spinner</a> control to be shown while the collection is fetching, to let the user know we’re working on returning their data.</p>
<p>We can place the spinner in the header’s “client” area. This is exposed on <code>moon.Panel</code> via the <code>headerComponents</code> array:</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb26-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb26-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb26-3" title="3">        ...</a>
<a class="sourceLine" id="cb26-4" title="4">        <span class="dt">headerComponents</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb26-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Spinner&quot;</span><span class="op">,</span> <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Loading...&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;spinner&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb26-6" title="6">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb26-7" title="7">        ...</a>
<a class="sourceLine" id="cb26-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><code>enyo.Collection</code> provides a <code>status</code> property that is updated with its current state. We can bind the spinner’s <code>showing</code> property to updates of this property and use a transform to test for the specific conditions we’re interested in:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb27-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb27-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb27-3" title="3">        ...</a>
<a class="sourceLine" id="cb27-4" title="4">        <span class="dt">headerComponents</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb27-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Spinner&quot;</span><span class="op">,</span> <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;Loading...&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;spinner&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb27-6" title="6">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb27-7" title="7">        ...</a>
<a class="sourceLine" id="cb27-8" title="8">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb27-9" title="9">            ...<span class="op">,</span></a>
<a class="sourceLine" id="cb27-10" title="10">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;photos.status&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span><span class="st">&quot;$.spinner.showing&quot;</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> <span class="kw">function</span>(value) <span class="op">{</span></a>
<a class="sourceLine" id="cb27-11" title="11">                <span class="cf">return</span> <span class="kw">this</span>.<span class="va">photos</span>.<span class="at">isBusy</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb27-12" title="12">            <span class="op">}}</span></a>
<a class="sourceLine" id="cb27-13" title="13">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb27-14" title="14">        ...</a>
<a class="sourceLine" id="cb27-15" title="15">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>That’s all there is to it! Now, when you press <strong>Enter</strong> to start a search, you should see the spinner run until the data is returned and the list is updated.</p>
<p><em>Note:</em> A transform is a handy way to convert data in one format to another, such as converting a string to a number. In this case, we could have looked up all the status codes for the collection that correspond to a busy state and converted that to the boolean we need, however, collection provides a convenience method called <code>isBusy()</code> that does exactly what we need.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/3D7BM/">View the code and results of Step 12 in JSFiddle</a></strong></p>
<h2 id="create-a-photo-detail-panel">13. Create a photo detail panel</h2>
<p>Now that we have a fully functioning search panel, let’s move ahead and add a photo detail panel. This will show a larger version of the image selected from the search panel, along with some more detailed information about the photo–for example, the user who took the photo and the date it was taken.</p>
<p>First, we’ll create another subkind of <code>moon.Panel</code> for our detail panel, and place a <a href="../..//#/kind/moon.Image">moon.Image</a> in the <code>components</code> block. (We’ll use the panel header’s <code>titleBelow</code> and <code>subTitleBelow</code> properties to show the other data.)</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb28-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb28-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb28-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb28-4" title="4">        <span class="dt">layoutKind</span><span class="op">:</span> <span class="st">&quot;FittableColumnsLayout&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb28-5" title="5">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb28-6" title="6">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Image&quot;</span><span class="op">,</span> <span class="dt">fit</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">sizing</span><span class="op">:</span> <span class="st">&quot;contain&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb28-7" title="7">        ]</a>
<a class="sourceLine" id="cb28-8" title="8">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>layoutKind</strong> - As mentioned earlier, the default <code>layoutKind</code> for <code>moon.Panels</code> is <code>FittableRowsLayout</code>. Here we change the value to <code>FittableColumnsLayout</code> so that components are laid out as columns.</p></li>
<li><p><strong>moon.Image</strong></p>
<ul>
<li><p><strong>fit</strong> - Because the image is the only component, setting <code>fit: true</code> on it makes it fill the entire width of the panel client area.</p></li>
<li><p><strong>sizing</strong> - This is a property of <code>moon.Image</code> (and <a href="../..//#/kind/enyo.Image">enyo.Image</a>) that allows us to specify sizing options for the image. Since we don’t know the aspect ratio of the image, setting <code>sizing</code> to <code>"contain"</code> causes the longer dimension to be fit to the available space, so that there is no cropping or stretching.</p></li>
</ul></li>
</ul>
<p>When we push this panel onto our main view’s <code>moon.Panels</code> (in the next step), we’ll set a <code>model</code> property on the panel, from which we’ll access the image URL. So let’s go ahead and set up bindings from the model’s <code>title</code> and <code>original</code> URL attribute to the view.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb29-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb29-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-3" title="3">        <span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-4" title="4">        <span class="dt">layoutKind</span><span class="op">:</span> <span class="st">&quot;FittableColumnsLayout&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb29-5" title="5">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb29-6" title="6">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Image&quot;</span><span class="op">,</span> <span class="dt">fit</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">sizing</span><span class="op">:</span> <span class="st">&quot;contain&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;image&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb29-7" title="7">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb29-8" title="8">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb29-9" title="9">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.title&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;title&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb29-10" title="10">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.original&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;$.image.src&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb29-11" title="11">        ]</a>
<a class="sourceLine" id="cb29-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>We can’t see this panel yet because we haven’t put it into the view. Let’s move on to our next step and do that.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/pDU5r/">View the code and results of Step 13 in JSFiddle</a></strong></p>
<h2 id="add-handlers-for-transitioning-to-detail-page">14. Add handlers for transitioning to detail page</h2>
<p>To get our new <code>flickr.DetailPanel</code> onto the screen, we’ll need to push a new panel onto the <code>moon.Panels</code> instance owned by our <code>flickr.MainView</code>. There are many patterns you could use to achieve this, depending on the information architecture and control structure of your application.</p>
<p>For this sample, we’ll consider the <code>flickr.MainView</code> to be the panel controller for the app (since it owns the panels instance), and provide a custom <code>onRequestPushPanel</code> event API for requesting that new panels be pushed onto the panel stack.</p>
<p>First, we’ll add a handler for the new custom <code>onRequestPushPanel</code> event to <code>flickr.MainView</code>; this handler will call the <code>pushPanel</code> API on our <code>moon.Panels</code> instance:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb30-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb30-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.MainView&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb30-3" title="3">        ...</a>
<a class="sourceLine" id="cb30-4" title="4">        <span class="dt">handlers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb30-5" title="5">            <span class="dt">onRequestPushPanel</span><span class="op">:</span> <span class="st">&quot;pushPanel&quot;</span></a>
<a class="sourceLine" id="cb30-6" title="6">        <span class="op">},</span></a>
<a class="sourceLine" id="cb30-7" title="7">        ...</a>
<a class="sourceLine" id="cb30-8" title="8">        <span class="dt">pushPanel</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb30-9" title="9">            <span class="kw">this</span>.<span class="va">$</span>.<span class="va">panels</span>.<span class="at">pushPanel</span>(<span class="va">inEvent</span>.<span class="at">panel</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb30-10" title="10">        <span class="op">}</span></a>
<a class="sourceLine" id="cb30-11" title="11">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>We’ll expect the event to have a <code>panel</code> property, which will hold the panel definition passed to the <code>pushPanel()</code> API on <code>moon.Panels</code> to create, render, and push the new panel onto the panel stack. With this mechanism in place, any child of <code>flickr.MainView</code> may bubble an <code>onRequestPushPanel</code> event with a <code>panel</code> property to push a new panel onto the stack.</p>
<p>First, let’s go back to the <code>flickr.SearchPanel</code> and add a tap handler to the grid list items that will use this new event API:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb31-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb31-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb31-3" title="3">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb31-4" title="4">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.DataGridList&quot;</span><span class="op">,</span> ...<span class="op">,</span> <span class="dt">ontap</span><span class="op">:</span> <span class="st">&quot;itemSelected&quot;</span><span class="op">,</span> ...<span class="op">}</span></a>
<a class="sourceLine" id="cb31-5" title="5">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb31-6" title="6">        ...</a>
<a class="sourceLine" id="cb31-7" title="7">        <span class="dt">itemSelected</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb31-8" title="8">            <span class="co">// inEvent.index will reference the index associated with the tapped item</span></a>
<a class="sourceLine" id="cb31-9" title="9">            <span class="co">// inEvent.model will reference the model associated with the tapped item</span></a>
<a class="sourceLine" id="cb31-10" title="10">        <span class="op">}</span></a>
<a class="sourceLine" id="cb31-11" title="11">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>itemSelected()</strong></p>
<ul>
<li><p>Since the <code>ontap</code> handler was placed on the DataGridList, any tap events bubbling out of the grid list will be caught by the <code>itemSelected()</code> function.</p></li>
<li><p>Note that any events bubbled from subkinds of <a href="../..//#/kind/enyo.DataRepeater">enyo.DataRepeater</a> (such as <code>moon.DataGridList</code>) will include <code>inEvent.model</code> and <code>inEvent.index</code> properties to allow you to identify the item that originated the event and the model associated with it.</p></li>
</ul></li>
</ul>
<p>Next, we declare that the <code>flickr.SearchPanel</code> will bubble the <code>onRequestPushPanel</code> event, and then implement the <code>itemSelected()</code> handler to bubble the event, passing the panel definition in the event payload:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb32-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb32-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.SearchPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb32-3" title="3">        <span class="dt">events</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb32-4" title="4">            <span class="dt">onRequestPushPanel</span><span class="op">:</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb32-5" title="5">        <span class="op">},</span></a>
<a class="sourceLine" id="cb32-6" title="6">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb32-7" title="7">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.DataGridList&quot;</span><span class="op">,</span> ...<span class="op">,</span> <span class="dt">ontap</span><span class="op">:</span> <span class="st">&quot;itemSelected&quot;</span><span class="op">,</span> ...<span class="op">}</span></a>
<a class="sourceLine" id="cb32-8" title="8">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb32-9" title="9">        ...</a>
<a class="sourceLine" id="cb32-10" title="10">        <span class="dt">itemSelected</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb32-11" title="11">            <span class="kw">this</span>.<span class="at">doRequestPushPanel</span>(<span class="op">{</span><span class="dt">panel</span><span class="op">:</span> <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span> <span class="dt">model</span><span class="op">:</span> <span class="va">inEvent</span>.<span class="at">model</span><span class="op">}}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb32-12" title="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb32-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p><strong>events</strong> - By declaring <code>onRequestPushPanel</code> in the <code>events</code> block, we tell the framework (and anyone who uses the kind) that this kind will bubble that event. While this is a convention for defining the kind’s API, the declaration also gives us an automatic <code>do&lt;EventName&gt;</code> convenience function for bubbling the event.</p></li>
<li><p><strong>doRequestPushPanel()</strong> - Calling the convenience method <code>doRequestPushPanel()</code> is equivalent to calling <code>this.bubble("onRequestPushPanel", &lt;event&gt;)</code>. As the second parameter, we pass an “event payload” object that contains a <code>panel</code> property, as expected by the <code>onRequestPushPanel</code> handler in <code>flickr.MainView</code>. The <code>panel</code> property contains the definition of the panel kind we want to push onto the panel stack–namely, <code>flickr.DetailPanel</code>. We also pass the model associated with the item tapped as a property of the newly created detail panel, to be used by bindings into the view.</p></li>
</ul>
<p>Go ahead and try this: Do a search, then click on an image. The search panel should “breadcrumb” and animate to the left, while the detail panel should appear with the title set and the image displayed below the header.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/PZBTC/">View the code and results of Step 14 in JSFiddle</a></strong></p>
<h2 id="get-detailed-photo-information">15. Get detailed photo information</h2>
<p>Recall that we wanted to show some more detail on the photo detail page, such as the name of the user who took the photo and the date it was taken. Although Flickr provides this information, it is, unfortunately, not included in the records returned from the search API. It is actually quite common for REST APIs that a fetch of a collection of models to return only a subset of the available fields. A subsequent fetch of the record (using the model’s primary key) is then needed to get the full set of fields.</p>
<p>No problem. We’ll just go back to our <code>flickr.ImageModel</code> and implement a <code>fetch()</code>/<code>parse()</code> scheme similar to what we have in our collection, to enable the fetching of a full image record based on the partial information obtained from the search collection. When we move to the detail panel, we’ll call <code>fetch()</code> on the model to request the additional information.</p>
<p>First, let’s set the <code>source</code> for the image model to our Flickr source, and then override the <code>fetch()</code> function on <code>enyo.Model</code> to pass <code>flickr.Source</code> a <code>params</code> hash with the information needed to fetch detailed image models (similar to what we did in <code>flickr.SearchCollection</code>):</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb33-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb33-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.ImageModel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-3" title="3">        <span class="dt">source</span><span class="op">:</span> <span class="st">&quot;flickr&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-4" title="4">        ...</a>
<a class="sourceLine" id="cb33-5" title="5">        <span class="dt">fetch</span><span class="op">:</span> <span class="kw">function</span>(opts) <span class="op">{</span></a>
<a class="sourceLine" id="cb33-6" title="6">            <span class="kw">this</span>.<span class="at">params</span> <span class="op">=</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb33-7" title="7">                <span class="dt">method</span><span class="op">:</span> <span class="st">&quot;flickr.photos.getinfo&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb33-8" title="8">                <span class="dt">photo_id</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">get</span>(<span class="st">&quot;id&quot;</span>)</a>
<a class="sourceLine" id="cb33-9" title="9">            <span class="op">};</span></a>
<a class="sourceLine" id="cb33-10" title="10">            <span class="cf">return</span> <span class="kw">this</span>.<span class="at">inherited</span>(<span class="kw">arguments</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb33-11" title="11">        <span class="op">}</span></a>
<a class="sourceLine" id="cb33-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Here, we set the <code>method</code> parameter to <code>flickr.photos.getinfo</code> to reach the <a href="https://www.flickr.com/services/api/flickr.photos.getinfo.html">Flickr photo information endpoint</a>. We also pass a <code>photo_id</code> property, whose value will already be available from the partial field set loaded by the collection.</p>
<p>Next, let’s examine the <a href="https://api.flickr.com/services/rest/?method=flickr.photos.getinfo&amp;photo_id=59948935&amp;api_key=2a21b46e58d207e4888e1ece0cb149a5&amp;format=json&amp;jsoncallback=enyo_jsonp_callback_1">data we get back</a> from a call to this endpoint:</p>
<p><strong>Sample of data returned by call to “flickr.photos.getinfo” API</strong></p>
<pre><code>    {
        &quot;photo&quot;: {
            &quot;id&quot;: &quot;59948935&quot;,
            &quot;secret&quot;: &quot;a91e6e451d&quot;,
            &quot;server&quot;: &quot;28&quot;,
            &quot;farm&quot;: 1,
            &quot;dateuploaded&quot;: &quot;1131178052&quot;,
            &quot;isfavorite&quot;: 0,
            &quot;license&quot;: &quot;0&quot;,
            &quot;safety_level&quot;: &quot;0&quot;,
            &quot;rotation&quot;: 0,
            &quot;owner&quot;: {
                &quot;nsid&quot;: &quot;44124472651@N01&quot;,
                &quot;username&quot;: &quot;Ben McLeod&quot;,
                &quot;realname&quot;: &quot;Ben McLeod&quot;,
                &quot;location&quot;: &quot;Portland, OR, USA&quot;,
                &quot;iconserver&quot;: &quot;1&quot;,
                &quot;iconfarm&quot;: 1,
                &quot;path_alias&quot;: &quot;benmcleod&quot;
            },
            ...
            &quot;dates&quot;: {
                &quot;posted&quot;: &quot;1131178052&quot;,
                &quot;taken&quot;: &quot;2005-11-05 02:03:00&quot;,
                &quot;takengranularity&quot;: &quot;0&quot;,
                &quot;lastupdate&quot;: &quot;1389562416&quot;
            },
            ...
        }
    }</code></pre>
<p>Again, the data fields for the <code>flickr.ImageModel</code> attributes are nested inside a <code>photos</code> object, so we’ll need to add a <code>parse()</code> function to our model to return just the set of fields to be added to the model’s attributes from the raw data. For performance, <code>enyo.Model</code> only makes the top-level properties bindable. Since we’re interested in the <code>owner.realname</code> and <code>dates.taken</code> fields, we can deal with those in the <code>parse()</code> function also:</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb35-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb35-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.ImageModel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb35-3" title="3">        ...</a>
<a class="sourceLine" id="cb35-4" title="4">        <span class="dt">options</span><span class="op">:</span> <span class="op">{</span> <span class="dt">parse</span><span class="op">:</span> <span class="kw">true</span> <span class="op">},</span></a>
<a class="sourceLine" id="cb35-5" title="5">        ...</a>
<a class="sourceLine" id="cb35-6" title="6">        <span class="dt">parse</span><span class="op">:</span> <span class="kw">function</span>(data) <span class="op">{</span></a>
<a class="sourceLine" id="cb35-7" title="7">            data <span class="op">=</span> <span class="va">data</span>.<span class="at">photo</span> <span class="op">||</span> data<span class="op">;</span></a>
<a class="sourceLine" id="cb35-8" title="8">            <span class="va">data</span>.<span class="at">title</span> <span class="op">=</span> <span class="va">data</span>.<span class="va">title</span>.<span class="at">_content</span> <span class="op">||</span> <span class="va">data</span>.<span class="at">title</span><span class="op">;</span></a>
<a class="sourceLine" id="cb35-9" title="9">            <span class="va">data</span>.<span class="at">username</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">owner</span> <span class="op">&amp;&amp;</span> <span class="va">data</span>.<span class="va">owner</span>.<span class="at">realname</span><span class="op">;</span></a>
<a class="sourceLine" id="cb35-10" title="10">            <span class="va">data</span>.<span class="at">taken</span> <span class="op">=</span> <span class="va">data</span>.<span class="at">dates</span> <span class="op">&amp;&amp;</span> <span class="va">data</span>.<span class="va">dates</span>.<span class="at">taken</span><span class="op">;</span></a>
<a class="sourceLine" id="cb35-11" title="11">            <span class="cf">return</span> data<span class="op">;</span></a>
<a class="sourceLine" id="cb35-12" title="12">        <span class="op">}</span></a>
<a class="sourceLine" id="cb35-13" title="13">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p><strong>Additional notes on this code:</strong></p>
<ul>
<li><p>Since <code>parse()</code> processes data returned from both the <code>search</code> API and the <code>getInfo</code> API, we need to ensure that the method works in both cases. Unfortunately, there are slight differences in how the returned data is formatted for the two cases. For example, the <code>search</code> API returns <code>title</code> as a top-level property, while <code>getinfo</code> returns the title in the <code>title._content</code> property. So our <code>parse()</code> function must deal with these differences.</p></li>
<li><p>We also move the <code>realname</code> and <code>taken</code> properties (when present) from their nested locations directly onto the data hash being returned, so that they are bindable as top-level attributes.</p></li>
</ul>
<p>Note that we won’t see a change in the app yet, since we’re not explicitly fetching the full model yet. We’ll do that next.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/mX9Z9/">View the code and results of Step 15 in JSFiddle</a></strong></p>
<h2 id="fetch-and-bind-detailed-image-data-to-detail-panel">16. Fetch and bind detailed image data to detail panel</h2>
<p>Now that we have a <code>fetch()</code> method on our model that can retrieve detailed information, let’s put it to use.</p>
<p>Although we could have the collection automatically fetch detailed information as soon as the model is loaded into the collection, that would require a lot of network overhead for data that may never be shown (since we’ll only show it if the user moves to the detail page for that item). So we’ll only fetch the detailed data once the user has decided to view the detail page.</p>
<p>We could call <code>fetch()</code> in the <code>itemSelected</code> handler in <code>flickr.SearchPanel</code>, but we’ll avoid doing so for one simple reason: performance. Since we’ll bind the detail properties to the view, the data will be pushed into the view (causing a DOM update) as soon as it is fetched. In general, that’s great, but some platforms have trouble maintaining acceptable animation frame rates while updating the DOM. Since the <code>itemSelected</code> handler calls <code>pushPanels()</code>, causing an immediate panel animation, we’ll defer calling the model <code>fetch()</code> until the animation completes.</p>
<p>Luckily, <code>moon.Panels</code> lets us specify a callback (<code>transitionFinished</code>) that allows us to do post-transition work, such as updating the view. We’ll implement this on our panel instance, and call <code>this.model.fetch()</code> when we are moving <em>to</em> the detail panel (i.e., when the “to” index is greater than the “from” index):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb36-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb36-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb36-3" title="3">        ...</a>
<a class="sourceLine" id="cb36-4" title="4">        <span class="dt">transitionFinished</span><span class="op">:</span> <span class="kw">function</span>(inInfo) <span class="op">{</span></a>
<a class="sourceLine" id="cb36-5" title="5">            <span class="cf">if</span> (<span class="va">inInfo</span>.<span class="at">from</span> <span class="op">&lt;</span> <span class="va">inInfo</span>.<span class="at">to</span>) <span class="op">{</span></a>
<a class="sourceLine" id="cb36-6" title="6">                <span class="kw">this</span>.<span class="va">model</span>.<span class="at">fetch</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb36-7" title="7">            <span class="op">}</span></a>
<a class="sourceLine" id="cb36-8" title="8">        <span class="op">}</span></a>
<a class="sourceLine" id="cb36-9" title="9">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Now all we need to do is add some bindings to get our detailed data properties (<code>realname</code> and <code>taken</code>) into the view. Here are some simple bindings that bind these fields into the panel header’s <code>titleBelow</code> and <code>subTitleBelow</code> properties:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb37-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb37-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb37-3" title="3">        ...</a>
<a class="sourceLine" id="cb37-4" title="4">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb37-5" title="5">            ...</a>
<a class="sourceLine" id="cb37-6" title="6">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.username&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;titleBelow&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb37-7" title="7">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.taken&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;subTitleBelow&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb37-8" title="8">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb37-9" title="9">        ...</a>
<a class="sourceLine" id="cb37-10" title="10">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>We can make it a bit more interesting if we add transform functions to the bindngs, to format the raw values from the model into more user-friendly strings:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb38-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb38-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb38-3" title="3">        ...</a>
<a class="sourceLine" id="cb38-4" title="4">        <span class="dt">bindings</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb38-5" title="5">            ...</a>
<a class="sourceLine" id="cb38-6" title="6">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.username&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;titleBelow&quot;</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> <span class="kw">function</span>(val) <span class="op">{</span></a>
<a class="sourceLine" id="cb38-7" title="7">                <span class="cf">return</span> <span class="st">&quot;By &quot;</span> <span class="op">+</span> (val <span class="op">||</span> <span class="st">&quot; unknown user&quot;</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb38-8" title="8">            <span class="op">}},</span></a>
<a class="sourceLine" id="cb38-9" title="9">            <span class="op">{</span><span class="dt">from</span><span class="op">:</span> <span class="st">&quot;model.taken&quot;</span><span class="op">,</span> <span class="dt">to</span><span class="op">:</span> <span class="st">&quot;subTitleBelow&quot;</span><span class="op">,</span> <span class="dt">transform</span><span class="op">:</span> <span class="kw">function</span>(val) <span class="op">{</span></a>
<a class="sourceLine" id="cb38-10" title="10">                <span class="cf">return</span> val <span class="op">?</span> <span class="st">&quot;Taken &quot;</span> <span class="op">+</span> val : <span class="st">&quot;&quot;</span><span class="op">;</span></a>
<a class="sourceLine" id="cb38-11" title="11">            <span class="op">}}</span></a>
<a class="sourceLine" id="cb38-12" title="12">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb38-13" title="13">        ...</a>
<a class="sourceLine" id="cb38-14" title="14">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Now, when you move to the detail page, you should see the user and date taken information in the header as soon as the data is fetched.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/Ld9HJ/">View the code and results of Step 16 in JSFiddle</a></strong></p>
<h2 id="add-fullscreen-image-viewer">17. Add fullscreen image viewer</h2>
<p>The “Always Viewing” panels pattern used in this app is specially designed to provide a lightweight browsing interface in <code>moon.Panels</code> above fullscreen content, such as fullscreen video playback, audio playback, or photo viewing. To demonstrate how to switch between the panels overlay and the fullscreen content, we’ll add a simple image viewer in the “basement” (a term we use to describe the screen area underneath any overlying panels).</p>
<p>First, let’s add the image viewer. <a href="../..//#/kind/enyo.ImageView">enyo.ImageView</a> provides a basic image view with scroll-to-zoom and drag-to-pan capability. We’ll place an ImageView in our <code>flickr.MainView</code>, <em>before</em> the panels instance, using the <code>enyo-fit</code> class to fit it to the full bounds of the screen:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb39-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb39-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.MainView&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb39-3" title="3">        <span class="dt">components</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb39-4" title="4">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;enyo.ImageView&quot;</span><span class="op">,</span> <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;imageViewer&quot;</span><span class="op">,</span> <span class="dt">classes</span><span class="op">:</span> <span class="st">&quot;enyo-fit&quot;</span><span class="op">,</span> <span class="dt">src</span><span class="op">:</span> <span class="st">&quot;assets/splash.png&quot;</span><span class="op">},</span></a>
<a class="sourceLine" id="cb39-5" title="5">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Panels&quot;</span><span class="op">,</span> ...<span class="op">}</span></a>
<a class="sourceLine" id="cb39-6" title="6">        ]</a>
<a class="sourceLine" id="cb39-7" title="7">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>Next, let’s add another custom event handler to the main view to allow the <code>flickr.DetailPanel</code> (or any other panel we may add in the future) to request that a new image be loaded into the image viewer:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb40-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb40-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.MainView&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb40-3" title="3">        <span class="dt">handlers</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb40-4" title="4">            ...</a>
<a class="sourceLine" id="cb40-5" title="5">            <span class="dt">onRequestFullScreen</span><span class="op">:</span> <span class="st">&quot;fullscreen&quot;</span></a>
<a class="sourceLine" id="cb40-6" title="6">        <span class="op">},</span></a>
<a class="sourceLine" id="cb40-7" title="7">        ...</a>
<a class="sourceLine" id="cb40-8" title="8">        <span class="dt">fullscreen</span><span class="op">:</span> <span class="kw">function</span>(inSender<span class="op">,</span> inEvent) <span class="op">{</span></a>
<a class="sourceLine" id="cb40-9" title="9">            <span class="kw">this</span>.<span class="va">$</span>.<span class="va">imageViewer</span>.<span class="at">set</span>(<span class="st">&quot;src&quot;</span><span class="op">,</span> <span class="va">inEvent</span>.<span class="va">model</span>.<span class="at">get</span>(<span class="st">&quot;original&quot;</span>))<span class="op">;</span></a>
<a class="sourceLine" id="cb40-10" title="10">            <span class="kw">this</span>.<span class="va">$</span>.<span class="va">panels</span>.<span class="at">hide</span>()<span class="op">;</span></a>
<a class="sourceLine" id="cb40-11" title="11">        <span class="op">}</span></a>
<a class="sourceLine" id="cb40-12" title="12">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>As before, the custom event handler expects a specific event payload–here the <code>model</code> property should be set to the image model that is requesting fullscreen viewing. We’ll set the <code>original</code> URL property to the <code>src</code> property of the <code>enyo.ImageView</code>. We’ll also hide the panels, so that the fullscreen content is unobstructed. The user can always return to the panels to resume browsing by hovering over the handle at the right edge of the screen and tapping.</p>
<p>Now we need to bubble this new event from our detail page. Let’s add a “View Fullscreen” button to the panel header’s client area, along with a tap handler that bubbles the <code>onRequestFullScreen</code> event, passing the model mentioned above:</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode javascript"><code class="sourceCode javascript"><a class="sourceLine" id="cb41-1" title="1">    <span class="va">enyo</span>.<span class="at">kind</span>(<span class="op">{</span></a>
<a class="sourceLine" id="cb41-2" title="2">        <span class="dt">name</span><span class="op">:</span> <span class="st">&quot;flickr.DetailPanel&quot;</span><span class="op">,</span></a>
<a class="sourceLine" id="cb41-3" title="3">        ...</a>
<a class="sourceLine" id="cb41-4" title="4">        <span class="dt">events</span><span class="op">:</span> <span class="op">{</span></a>
<a class="sourceLine" id="cb41-5" title="5">            <span class="dt">onRequestFullScreen</span><span class="op">:</span> <span class="st">&quot;&quot;</span></a>
<a class="sourceLine" id="cb41-6" title="6">        <span class="op">},</span></a>
<a class="sourceLine" id="cb41-7" title="7">        ...</a>
<a class="sourceLine" id="cb41-8" title="8">        <span class="dt">headerComponents</span><span class="op">:</span> [</a>
<a class="sourceLine" id="cb41-9" title="9">            <span class="op">{</span><span class="dt">kind</span><span class="op">:</span> <span class="st">&quot;moon.Button&quot;</span><span class="op">,</span> <span class="dt">ontap</span><span class="op">:</span> <span class="st">&quot;requestFullScreen&quot;</span><span class="op">,</span> <span class="dt">small</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span> <span class="dt">content</span><span class="op">:</span> <span class="st">&quot;View Fullscreen&quot;</span><span class="op">}</span></a>
<a class="sourceLine" id="cb41-10" title="10">        ]<span class="op">,</span></a>
<a class="sourceLine" id="cb41-11" title="11">        ...</a>
<a class="sourceLine" id="cb41-12" title="12">        <span class="dt">requestFullScreen</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span></a>
<a class="sourceLine" id="cb41-13" title="13">            <span class="kw">this</span>.<span class="at">doRequestFullScreen</span>(<span class="op">{</span><span class="dt">model</span><span class="op">:</span> <span class="kw">this</span>.<span class="at">model</span><span class="op">}</span>)<span class="op">;</span></a>
<a class="sourceLine" id="cb41-14" title="14">        <span class="op">}</span></a>
<a class="sourceLine" id="cb41-15" title="15">    <span class="op">}</span>)<span class="op">;</span></a></code></pre></div>
<p>You should be able to press the “View Fullscreen” button from the detail view and see the selected photo fullscreen, then return to browsing by re-opening the panels via the handle at the right edge.</p>
<p><strong><a href="http://jsfiddle.net/enyojs/AB7J6/">View the code and results of Step 17 in JSFiddle</a></strong></p>
<h2 id="final-embellishments">18. Final embellishments</h2>
<p>In our final app, you’ll see that we made a few additional improvements:</p>
<ul>
<li><p>We extended <code>enyo.ImageView</code> to provide a basic slideshow capability. Besides subkinding <code>enyo.ImageView</code>, this entailed moving the <code>photos</code> search collection up to the main view, to be bindable both to the slideshow and the search panel. We also added one more top-level event handler to request a slideshow from the search panel.</p></li>
<li><p>For fun, we added a <a href="../..//#/kind/moon.ContextualPopup">moon.ContextualPopup</a> on the detail page containing a QR code link to the full-size image, to allow a user to quickly open the image on a mobile device with a bar-code reader app.</p></li>
</ul>
<p>Feel free to browse through these additions, and to try adding your own ideas for features to improve the app!</p>
<p><strong>View the finished <a href="http://enyojs.github.io/moon-flickr">application</a> and <a href="https://github.com/enyojs/moon-flickr">source code</a></strong></p>
<h2 id="minifydeploy-your-app">19. Minify/deploy your app</h2>
<p>When you are finished developing your app, you will want to “deploy” it. As you’ll recall, we’ve been developing our app in the top-level <code>debug.html</code> file, which loads the full un-minified Enyo core, library, and application source. This is great for debugging, but when deploying your app to a device or to the Web, you’ll first want to run the <code>deploy</code> script supplied with <code>bootplate</code>.</p>
<p>To minify/deploy your app, simply run the following from the command line, from your application’s root directory (this requires Node.js; see <a href="#set-up-your-development-environment">Step 1</a>):</p>
<p>Mac/Linux:</p>
<pre><code>    $ tools/deploy.sh -T</code></pre>
<p>Windows:</p>
<pre><code>    &gt; tools\deploy.bat -T</code></pre>
<p>Following a successful run, you should now be able to load <code>index.html</code> from the root of your app, and you should see a significant improvement in load time. What’s more, the <code>/deploy</code> folder in the root of your app will contain <em>only</em> the minimum set of files needed for packaging into a native app wrapper like Cordova/PhoneGap, or deploying to a Web server, with all source files removed.</p>
<p>Please refer to the <a href="../deploying-apps/platform-specific-deployment.html">Platform-Specific Deployment</a> guide for more information.</p>
<p><strong>Note for webOS developers:</strong> The <code>ares-package</code> tool provided with the webOS SDK should be used to deploy Enyo apps when packaging for webOS. It will call the <code>deploy</code> script internally as part of the packaging process, so there is no need to run the bootplate <code>deploy</code> script separately.</p>

  </div>

</div>

  <div class="container-fluid">
    <div class="row" id="footer">
  	<div class="license">
  		<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a>
  	</div>
      <div class="text-right generated">
        Generated Monday, February 28, 2022
      </div>
    </div>
  </div>
  
  <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
  <!-- Include all compiled plugins (below), or include individual files as needed -->
  <script src="../../js/bootstrap.min.js"></script>
  
  <script type="text/javascript">$.browser = {}; $.browser.msie = navigator.userAgent.match(/msie/i); /* Patch for hashchange */</script>
  <script type="text/javascript" src="../../js/jquery.ba-hashchange.min.js"></script>
  <script type="text/javascript" src="../../js/main.js"></script>
  <script type="text/javascript" src="../../js/prism.js"></script>
  
  <script type="text/javascript">
  
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28416388-1']);
    _gaq.push(['_trackPageview']);
  
    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  
  </script>
  
  </body>
  </html>
